
<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>cpystal.core.core &#8212; cpystal  documentation</title>
    <link rel="stylesheet" type="text/css" href="../../../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/alabaster.css" />
    <script data-url_root="../../../" id="documentation_options" src="../../../_static/documentation_options.js"></script>
    <script src="../../../_static/jquery.js"></script>
    <script src="../../../_static/underscore.js"></script>
    <script src="../../../_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="../../../_static/doctools.js"></script>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" />
   
  <link rel="stylesheet" href="../../../_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <h1>Source code for cpystal.core.core</h1><div class="highlight"><pre>
<span></span><span class="sd">&quot;&quot;&quot;`cpystal`: for dealing with crystals and experimental data of physical property.</span>

<span class="sd">`cpystal` is designed to handle experimental data on crystals.</span>
<span class="sd">It places particular emphasis on calculating and storing data on the properties of actual synthesized samples, </span>
<span class="sd">and on graphing these data. In this respect, it is distinct from `pymatgen`, a similar crystal and material analysis module.</span>
<span class="sd">Of course, pymatgen is a very useful python module, so we use it as an adjunct in `cpystal`.</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="kn">from</span> <span class="nn">__future__</span> <span class="kn">import</span> <span class="n">annotations</span>

<span class="kn">from</span> <span class="nn">collections</span> <span class="kn">import</span> <span class="n">defaultdict</span>
<span class="kn">from</span> <span class="nn">math</span> <span class="kn">import</span> <span class="n">pi</span><span class="p">,</span> <span class="n">sqrt</span><span class="p">,</span> <span class="n">cos</span><span class="p">,</span> <span class="n">radians</span>
<span class="kn">import</span> <span class="nn">re</span>
<span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Any</span><span class="p">,</span> <span class="n">Dict</span><span class="p">,</span> <span class="n">List</span><span class="p">,</span> <span class="n">TypeVar</span>

<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">numpy.typing</span> <span class="k">as</span> <span class="nn">npt</span>
<span class="kn">import</span> <span class="nn">scipy.signal</span> <span class="c1"># type: ignore</span>


<span class="c1"># データ処理用</span>
<div class="viewcode-block" id="str_to_float"><a class="viewcode-back" href="../../../cpystal.core.html#cpystal.core.core.str_to_float">[docs]</a><span class="k">def</span> <span class="nf">str_to_float</span><span class="p">(</span><span class="n">s</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span> <span class="o">|</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Convert str number to float object.</span>

<span class="sd">    Args:</span>
<span class="sd">        s (str): str-type number.</span>
<span class="sd">    </span>
<span class="sd">    Returns:</span>
<span class="sd">        (int | None): None if s is empty-string, float otherwise</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">s</span> <span class="o">==</span> <span class="s1">&#39;&#39;</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">None</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="nb">float</span><span class="p">(</span><span class="n">s</span><span class="p">)</span></div>

<span class="c1"># データ平滑化</span>
<div class="viewcode-block" id="smoothing"><a class="viewcode-back" href="../../../cpystal.core.html#cpystal.core.core.smoothing">[docs]</a><span class="k">def</span> <span class="nf">smoothing</span><span class="p">(</span><span class="n">data</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">float</span><span class="p">],</span> <span class="n">mode</span><span class="p">:</span> <span class="n">Any</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="nb">float</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Data smoothing function.</span>

<span class="sd">    Args:</span>
<span class="sd">        data (list[float]): 1-dimension data.</span>
<span class="sd">        mode (Any): To choose smoothing algorithm. Savitzky-Golay filter if mode == &quot;s&quot;, Simple Moving Average otherwise.</span>

<span class="sd">    Returns:</span>
<span class="sd">        (list[float]): smoothed data.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">mode</span> <span class="o">==</span> <span class="s2">&quot;s&quot;</span><span class="p">:</span> <span class="c1"># Savitzky-Golay filter</span>
        <span class="n">deg</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">2</span> <span class="c1"># 多項式の次数</span>
        <span class="n">window_length</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)</span><span class="o">//</span><span class="mi">4</span><span class="o">*</span><span class="mi">2</span><span class="o">+</span><span class="mi">1</span> <span class="c1"># 窓幅</span>
        <span class="n">deriv</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span> <span class="c1"># 微分階数</span>
        <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">float</span><span class="p">,</span> <span class="n">scipy</span><span class="o">.</span><span class="n">signal</span><span class="o">.</span><span class="n">savgol_filter</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">window_length</span><span class="o">=</span><span class="n">window_length</span><span class="p">,</span> <span class="n">polyorder</span><span class="o">=</span><span class="n">deg</span><span class="p">,</span> <span class="n">deriv</span><span class="o">=</span><span class="n">deriv</span><span class="p">)))</span>
      
    <span class="k">else</span><span class="p">:</span> <span class="c1"># 単純移動平均</span>
        <span class="n">window</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">9</span> <span class="c1"># 移動平均の範囲</span>
        <span class="n">w</span><span class="p">:</span> <span class="n">Any</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">window</span><span class="p">)</span><span class="o">/</span><span class="n">window</span>
        <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">float</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">convolve</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">w</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;same&#39;</span><span class="p">)))</span></div>

<span class="c1"># 日本化学会原子量表(2021)より</span>
<span class="c1"># 原子量の定義：質量数12の炭素原子 12C の質量を正確に12としたときの相対質量</span>
<span class="c1"># 注意： ・原子量定義の諸々は元文献が詳しいので，慎重な取り扱いが必要な場面ではそちらを参照すること</span>
<span class="c1">#       ・安定各種が複数ある原子の原子量はその同位体存在比によって時間・空間変化する</span>
<span class="c1">#       ・以下のdictの13元素でコメントアウトされている区間[a,b]は地球上での変動範囲を表す</span>
<span class="c1">#           ・その13元素の原子量はすべて有効数字4桁の数値を用いた</span>
<span class="c1">#       ・(安定同位体が存在しない元素は基本的に None とし，コメントアウトで放射性同位体の質量数の一例を示した)</span>
<span class="c1">#           ・Dict[str, float | None] にするとmypyのチェック回避が面倒なので削除した</span>
<span class="c1">#           ・ただし，安定同位体が存在しない元素のうちBi,Th,Pa,Uは地球上で固有の同位体比を示すため，原子量が定義されている</span>
<span class="c1">#       ・環境中の変動とは別に測定誤差も考慮する必要があるが，以下では記載していない</span>
<span class="n">atomic_weight</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;H&quot;</span><span class="p">:</span> <span class="mf">1.008</span><span class="p">,</span> <span class="c1"># [1.00784, 1.00811]</span>
    <span class="s2">&quot;He&quot;</span><span class="p">:</span> <span class="mf">4.002602</span><span class="p">,</span>
    <span class="s2">&quot;Li&quot;</span><span class="p">:</span> <span class="mf">6.941</span><span class="p">,</span> <span class="c1"># [6.938, 6.997]</span>
    <span class="s2">&quot;Be&quot;</span><span class="p">:</span> <span class="mf">9.0121831</span><span class="p">,</span>
    <span class="s2">&quot;B&quot;</span><span class="p">:</span> <span class="mf">10.81</span><span class="p">,</span> <span class="c1"># [10.806, 10.821]</span>
    <span class="s2">&quot;C&quot;</span><span class="p">:</span> <span class="mf">12.01</span><span class="p">,</span> <span class="c1"># [12.0096, 12.0116]</span>
    <span class="s2">&quot;N&quot;</span><span class="p">:</span> <span class="mf">14.01</span><span class="p">,</span> <span class="c1"># [14.00643, 14.00728]</span>
    <span class="s2">&quot;O&quot;</span><span class="p">:</span> <span class="mf">16.00</span><span class="p">,</span> <span class="c1"># [15.99903, 15.99977]</span>
    <span class="s2">&quot;F&quot;</span><span class="p">:</span> <span class="mf">18.998403163</span><span class="p">,</span>
    <span class="s2">&quot;Ne&quot;</span><span class="p">:</span> <span class="mf">20.1797</span><span class="p">,</span>
    <span class="s2">&quot;Na&quot;</span><span class="p">:</span> <span class="mf">22.98976928</span><span class="p">,</span>
    <span class="s2">&quot;Mg&quot;</span><span class="p">:</span> <span class="mf">24.31</span><span class="p">,</span> <span class="c1"># [24.304, 24.307]</span>
    <span class="s2">&quot;Al&quot;</span><span class="p">:</span> <span class="mf">26.9815384</span><span class="p">,</span>
    <span class="s2">&quot;Si&quot;</span><span class="p">:</span> <span class="mf">28.09</span><span class="p">,</span> <span class="c1"># [28.084, 28.086]</span>
    <span class="s2">&quot;P&quot;</span><span class="p">:</span> <span class="mf">30.973761998</span><span class="p">,</span>
    <span class="s2">&quot;S&quot;</span><span class="p">:</span> <span class="mf">32.07</span><span class="p">,</span> <span class="c1"># [32.059, 32.076]</span>
    <span class="s2">&quot;Cl&quot;</span><span class="p">:</span> <span class="mf">35.45</span><span class="p">,</span> <span class="c1"># [35.446, 35.457]</span>
    <span class="s2">&quot;Ar&quot;</span><span class="p">:</span> <span class="mf">39.95</span><span class="p">,</span> <span class="c1"># [39.792, 39.963]</span>
    <span class="s2">&quot;K&quot;</span><span class="p">:</span> <span class="mf">39.0983</span><span class="p">,</span>
    <span class="s2">&quot;Ca&quot;</span><span class="p">:</span> <span class="mf">40.078</span><span class="p">,</span>
    <span class="s2">&quot;Sc&quot;</span><span class="p">:</span> <span class="mf">44.955908</span><span class="p">,</span>
    <span class="s2">&quot;Ti&quot;</span><span class="p">:</span> <span class="mf">47.867</span><span class="p">,</span>
    <span class="s2">&quot;V&quot;</span><span class="p">:</span> <span class="mf">50.9415</span><span class="p">,</span>
    <span class="s2">&quot;Cr&quot;</span><span class="p">:</span> <span class="mf">51.9961</span><span class="p">,</span>
    <span class="s2">&quot;Mn&quot;</span><span class="p">:</span> <span class="mf">54.938043</span><span class="p">,</span>
    <span class="s2">&quot;Fe&quot;</span><span class="p">:</span> <span class="mf">55.845</span><span class="p">,</span>
    <span class="s2">&quot;Co&quot;</span><span class="p">:</span> <span class="mf">58.933194</span><span class="p">,</span>
    <span class="s2">&quot;Ni&quot;</span><span class="p">:</span> <span class="mf">58.6934</span><span class="p">,</span>
    <span class="s2">&quot;Cu&quot;</span><span class="p">:</span> <span class="mf">63.546</span><span class="p">,</span>
    <span class="s2">&quot;Zn&quot;</span><span class="p">:</span> <span class="mf">65.38</span><span class="p">,</span>
    <span class="s2">&quot;Ga&quot;</span><span class="p">:</span> <span class="mf">69.723</span><span class="p">,</span>
    <span class="s2">&quot;Ge&quot;</span><span class="p">:</span> <span class="mf">72.630</span><span class="p">,</span>
    <span class="s2">&quot;As&quot;</span><span class="p">:</span> <span class="mf">74.921595</span><span class="p">,</span>
    <span class="s2">&quot;Se&quot;</span><span class="p">:</span> <span class="mf">78.971</span><span class="p">,</span>
    <span class="s2">&quot;Br&quot;</span><span class="p">:</span> <span class="mf">79.90</span><span class="p">,</span> <span class="c1"># [79.901, 79.907]</span>
    <span class="s2">&quot;Kr&quot;</span><span class="p">:</span> <span class="mf">83.798</span><span class="p">,</span>
    <span class="s2">&quot;Rb&quot;</span><span class="p">:</span> <span class="mf">85.4678</span><span class="p">,</span>
    <span class="s2">&quot;Sr&quot;</span><span class="p">:</span> <span class="mf">87.62</span><span class="p">,</span>
    <span class="s2">&quot;Y&quot;</span><span class="p">:</span> <span class="mf">88.90584</span><span class="p">,</span>
    <span class="s2">&quot;Zr&quot;</span><span class="p">:</span> <span class="mf">91.224</span><span class="p">,</span>
    <span class="s2">&quot;Nb&quot;</span><span class="p">:</span> <span class="mf">92.90637</span><span class="p">,</span>
    <span class="s2">&quot;Mo&quot;</span><span class="p">:</span> <span class="mf">95.95</span><span class="p">,</span>
    <span class="c1">#&quot;Tc&quot;: None, # 99</span>
    <span class="s2">&quot;Ru&quot;</span><span class="p">:</span> <span class="mf">101.07</span><span class="p">,</span>
    <span class="s2">&quot;Rh&quot;</span><span class="p">:</span> <span class="mf">102.90549</span><span class="p">,</span>
    <span class="s2">&quot;Pd&quot;</span><span class="p">:</span> <span class="mf">106.42</span><span class="p">,</span>
    <span class="s2">&quot;Ag&quot;</span><span class="p">:</span> <span class="mf">107.8682</span><span class="p">,</span>
    <span class="s2">&quot;Cd&quot;</span><span class="p">:</span> <span class="mf">112.414</span><span class="p">,</span>
    <span class="s2">&quot;In&quot;</span><span class="p">:</span> <span class="mf">114.818</span><span class="p">,</span>
    <span class="s2">&quot;Sn&quot;</span><span class="p">:</span> <span class="mf">118.710</span><span class="p">,</span>
    <span class="s2">&quot;Sb&quot;</span><span class="p">:</span> <span class="mf">121.760</span><span class="p">,</span>
    <span class="s2">&quot;Te&quot;</span><span class="p">:</span> <span class="mf">127.60</span><span class="p">,</span>
    <span class="s2">&quot;I&quot;</span><span class="p">:</span> <span class="mf">126.90447</span><span class="p">,</span>
    <span class="s2">&quot;Xe&quot;</span><span class="p">:</span> <span class="mf">131.293</span><span class="p">,</span>
    <span class="s2">&quot;Cs&quot;</span><span class="p">:</span> <span class="mf">132.90545196</span><span class="p">,</span>
    <span class="s2">&quot;Ba&quot;</span><span class="p">:</span> <span class="mf">137.327</span><span class="p">,</span>
    <span class="s2">&quot;La&quot;</span><span class="p">:</span> <span class="mf">138.90547</span><span class="p">,</span>
    <span class="s2">&quot;Ce&quot;</span><span class="p">:</span> <span class="mf">140.116</span><span class="p">,</span>
    <span class="s2">&quot;Pr&quot;</span><span class="p">:</span> <span class="mf">140.90766</span><span class="p">,</span>
    <span class="s2">&quot;Nd&quot;</span><span class="p">:</span> <span class="mf">144.242</span><span class="p">,</span>
    <span class="c1">#&quot;Pm&quot;: None, # 145</span>
    <span class="s2">&quot;Sm&quot;</span><span class="p">:</span> <span class="mf">150.36</span><span class="p">,</span>
    <span class="s2">&quot;Eu&quot;</span><span class="p">:</span> <span class="mf">151.964</span><span class="p">,</span>
    <span class="s2">&quot;Gd&quot;</span><span class="p">:</span> <span class="mf">157.25</span><span class="p">,</span>
    <span class="s2">&quot;Tb&quot;</span><span class="p">:</span> <span class="mf">158.925354</span><span class="p">,</span>
    <span class="s2">&quot;Dy&quot;</span><span class="p">:</span> <span class="mf">162.500</span><span class="p">,</span>
    <span class="s2">&quot;Ho&quot;</span><span class="p">:</span> <span class="mf">164.930328</span><span class="p">,</span>
    <span class="s2">&quot;Er&quot;</span><span class="p">:</span> <span class="mf">167.259</span><span class="p">,</span>
    <span class="s2">&quot;Tm&quot;</span><span class="p">:</span> <span class="mf">168.934218</span><span class="p">,</span>
    <span class="s2">&quot;Yb&quot;</span><span class="p">:</span> <span class="mf">173.045</span><span class="p">,</span>
    <span class="s2">&quot;Lu&quot;</span><span class="p">:</span> <span class="mf">174.9668</span><span class="p">,</span>
    <span class="s2">&quot;Hf&quot;</span><span class="p">:</span> <span class="mf">178.486</span><span class="p">,</span>
    <span class="s2">&quot;Ta&quot;</span><span class="p">:</span> <span class="mf">180.94788</span><span class="p">,</span>
    <span class="s2">&quot;W&quot;</span><span class="p">:</span> <span class="mf">183.84</span><span class="p">,</span>
    <span class="s2">&quot;Re&quot;</span><span class="p">:</span> <span class="mf">186.207</span><span class="p">,</span>
    <span class="s2">&quot;Os&quot;</span><span class="p">:</span> <span class="mf">190.23</span><span class="p">,</span>
    <span class="s2">&quot;Ir&quot;</span><span class="p">:</span> <span class="mf">192.217</span><span class="p">,</span>
    <span class="s2">&quot;Pt&quot;</span><span class="p">:</span> <span class="mf">195.084</span><span class="p">,</span>
    <span class="s2">&quot;Au&quot;</span><span class="p">:</span> <span class="mf">196.966570</span><span class="p">,</span>
    <span class="s2">&quot;Hg&quot;</span><span class="p">:</span> <span class="mf">200.592</span><span class="p">,</span>
    <span class="s2">&quot;Tl&quot;</span><span class="p">:</span> <span class="mf">204.4</span><span class="p">,</span> <span class="c1"># [204.382, 204.385]</span>
    <span class="s2">&quot;Pb&quot;</span><span class="p">:</span> <span class="mf">207.2</span><span class="p">,</span>
    <span class="s2">&quot;Bi&quot;</span><span class="p">:</span> <span class="mf">208.98040</span><span class="p">,</span>
    <span class="c1">#&quot;Po&quot;: None, # 210</span>
    <span class="c1">#&quot;At&quot;: None, # 210</span>
    <span class="c1">#&quot;Rn&quot;: None, # 222</span>
    <span class="c1">#&quot;Fr&quot;: None, # 223</span>
    <span class="c1">#&quot;Ra&quot;: None, # 226</span>
    <span class="c1">#&quot;Ac&quot;: None, # 227</span>
    <span class="s2">&quot;Th&quot;</span><span class="p">:</span> <span class="mf">232.0377</span><span class="p">,</span>
    <span class="s2">&quot;Pa&quot;</span><span class="p">:</span> <span class="mf">231.03588</span><span class="p">,</span>
    <span class="s2">&quot;U&quot;</span><span class="p">:</span> <span class="mf">238.02891</span><span class="p">,</span>
    <span class="c1">#&quot;Np&quot;: None, # 237</span>
    <span class="c1">#&quot;Pu&quot;: None, # 239</span>
    <span class="c1">#&quot;Am&quot;: None, # 243</span>
    <span class="c1">#&quot;Cm&quot;: None, # 247</span>
    <span class="c1">#&quot;Bk&quot;: None, # 247</span>
    <span class="c1">#&quot;Cf&quot;: None, # 252</span>
    <span class="c1">#&quot;Es&quot;: None, # 252</span>
    <span class="c1">#&quot;Fm&quot;: None, # 257</span>
    <span class="c1">#&quot;Md&quot;: None, # 258</span>
    <span class="c1">#&quot;No&quot;: None, # 259</span>
    <span class="c1">#&quot;Lr&quot;: None, # 262</span>
    <span class="c1">#&quot;Rf&quot;: None, # 267</span>
    <span class="c1">#&quot;Db&quot;: None, # 268</span>
    <span class="c1">#&quot;Sg&quot;: None, # 271</span>
    <span class="c1">#&quot;Bh&quot;: None, # 272</span>
    <span class="c1">#&quot;Hs&quot;: None, # 277</span>
    <span class="c1">#&quot;Mt&quot;: None, # 276</span>
    <span class="c1">#&quot;Ds&quot;: None, # 281</span>
    <span class="c1">#&quot;Rg&quot;: None, # 280</span>
    <span class="c1">#&quot;Cn&quot;: None, # 285</span>
    <span class="c1">#&quot;Nh&quot;: None, # 278</span>
    <span class="c1">#&quot;Fl&quot;: None, # 289</span>
    <span class="c1">#&quot;Mc&quot;: None, # 289</span>
    <span class="c1">#&quot;Lv&quot;: None, # 293</span>
    <span class="c1">#&quot;Ts&quot;: None, # 293</span>
    <span class="c1">#&quot;Og&quot;: None, # 294</span>
<span class="p">}</span>


<div class="viewcode-block" id="SemimutableDict"><a class="viewcode-back" href="../../../cpystal.core.html#cpystal.core.core.SemimutableDict">[docs]</a><span class="k">class</span> <span class="nc">SemimutableDict</span><span class="p">(</span><span class="n">Dict</span><span class="p">[</span><span class="n">Any</span><span class="p">,</span> <span class="n">Any</span><span class="p">]):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Semi-mutable dictionary inherited from `dict`</span>

<span class="sd">    The only difference from `dict` is that using `[]` is not allowed, but using `update_force` method is allowed to replace the value.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">args</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__updatable</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>

    <span class="k">def</span> <span class="fm">__setitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span> <span class="n">value</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">key</span> <span class="ow">in</span> <span class="bp">self</span> <span class="ow">and</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">__updatable</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;elements of &#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s2">&#39; cannot be changed by &#39;[]&#39; operator; use &#39;update_force&#39; method&quot;</span><span class="p">)</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__setitem__</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__updatable</span> <span class="o">=</span> <span class="kc">False</span>

<div class="viewcode-block" id="SemimutableDict.update_force"><a class="viewcode-back" href="../../../cpystal.core.html#cpystal.core.core.SemimutableDict.update_force">[docs]</a>    <span class="k">def</span> <span class="nf">update_force</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span> <span class="n">value</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Instance method for replacing the value.</span>

<span class="sd">        Args:</span>
<span class="sd">            key (Any): Immutable object.</span>
<span class="sd">            value (Any): New value of `key`.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__updatable</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="bp">self</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span></div></div>
        

<span class="n">Crystalchild</span> <span class="o">=</span> <span class="n">TypeVar</span><span class="p">(</span><span class="s2">&quot;Crystalchild&quot;</span><span class="p">,</span> <span class="n">bound</span><span class="o">=</span><span class="s2">&quot;Crystal&quot;</span><span class="p">)</span>

<div class="viewcode-block" id="Crystal"><a class="viewcode-back" href="../../../cpystal.core.html#cpystal.core.core.Crystal">[docs]</a><span class="k">class</span> <span class="nc">Crystal</span><span class="p">:</span> <span class="c1"># 結晶の各物理量を計算</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;A `Crystal` instance corresponds to a certain sample of a crystal.</span>

<span class="sd">    Note:</span>
<span class="sd">        Any attribute of a `Crystal` instance can be freely assigned from the time it is created until the end of the program (i.e. mutable).</span>
<span class="sd">        However, once it is saved as a pickle file, it becomes impossible to change the attributes of the instance created by loading from the pickle file (i.e. immutable).</span>
<span class="sd">        This feature was implemented to prevent the unintentional destruction of the sample data which is saved in a pickle file.</span>

<span class="sd">    Attributes:</span>
<span class="sd">        name (str): The chemical formula of the crystal.</span>
<span class="sd">        graphname (str): TeX-formed `name`.</span>
<span class="sd">        date (str | None): The date the sample was synthesized. If there is a numbering system, it will be included here.</span>
<span class="sd">        spacegroup_name (str): Space group name in International (Hermann-Mauguin) notation of the crytal.</span>
<span class="sd">        NA (float): Avogadro constant 6.02214076 * 10**(23) [mol^-1].</span>
<span class="sd">        muB (float): Bohr magneton 9.27401 * 10**(-21) [emu].</span>
<span class="sd">        kB (float): Boltzmann constant 1.380649 * 10**(-23) [J/K].</span>
<span class="sd">        a (float): Lattice constant [Å].</span>
<span class="sd">        b (float): Lattice constant [Å].</span>
<span class="sd">        c (float): Lattice constant [Å].</span>
<span class="sd">        alpha (float): Lattice constant [°].</span>
<span class="sd">        beta (float): Lattice constant [°].</span>
<span class="sd">        gamma (float): Lattice constant [°].</span>
<span class="sd">        V (float): Volume of a unit cell [cm^3].</span>
<span class="sd">        Z (float): Number of formula unit in a unit cell.</span>
<span class="sd">        formula_weight (float): Weight of formula unit per mol [g/mol].</span>
<span class="sd">        w (float): The weight of the sample [g].</span>
<span class="sd">        num_magnetic_ion (float): Number of magnetic ions in a formula unit.</span>
<span class="sd">        density (float): Density of the crystal [g/cm^3].</span>
<span class="sd">        mol (float): The amount of substance of the sample [mol].</span>
<span class="sd">        numbered_name (float): Changed `name` that the elemental numbers in the chemical formula are clearly indicated by adding &#39;1&#39;.</span>
<span class="sd">        components (Defaultdict[str, float]): Number of each element in a formula unit.</span>
<span class="sd">        unit (dict[str, str]): The unit of each attribute.</span>
<span class="sd">        graphs (SemimutableDict[str, Any]): Semimutable dictionary of experimental data plotted as `matplotlib.axes._subplots.AxesSubplot` object.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">attributes</span><span class="p">:</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="o">...</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;name&quot;</span><span class="p">,</span> <span class="s2">&quot;graphname&quot;</span><span class="p">,</span> <span class="s2">&quot;date&quot;</span><span class="p">,</span> <span class="s2">&quot;spacegroup_name&quot;</span><span class="p">,</span> <span class="s2">&quot;NA&quot;</span><span class="p">,</span> <span class="s2">&quot;muB&quot;</span><span class="p">,</span> <span class="s2">&quot;kB&quot;</span><span class="p">,</span>
                <span class="s2">&quot;a&quot;</span><span class="p">,</span> <span class="s2">&quot;b&quot;</span><span class="p">,</span> <span class="s2">&quot;c&quot;</span><span class="p">,</span> <span class="s2">&quot;alpha&quot;</span><span class="p">,</span> <span class="s2">&quot;beta&quot;</span><span class="p">,</span> <span class="s2">&quot;gamma&quot;</span><span class="p">,</span> <span class="s2">&quot;V&quot;</span><span class="p">,</span> <span class="s2">&quot;Z&quot;</span><span class="p">,</span>
                <span class="s2">&quot;formula_weight&quot;</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">,</span> <span class="s2">&quot;num_magnetic_ion&quot;</span><span class="p">,</span> <span class="s2">&quot;density&quot;</span><span class="p">,</span> <span class="s2">&quot;mol&quot;</span><span class="p">,</span>
                <span class="s2">&quot;numbered_name&quot;</span><span class="p">,</span> <span class="s2">&quot;components&quot;</span><span class="p">,</span> <span class="s2">&quot;unit&quot;</span><span class="p">,</span> <span class="s2">&quot;graphs&quot;</span><span class="p">,)</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">date</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">auto_formula_weight</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;All attributes are initialized in `__init__` method.</span>

<span class="sd">        Args:</span>
<span class="sd">            name (str): The chemical formula of the crystal.</span>
<span class="sd">            date (str | None): The date the sample was synthesized. If there is a numbering system, it will be included here.</span>
<span class="sd">            auto_formula_weight (bool): If this argument is `True`, `formula_weight` is calculated automatically from `name`.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">name</span> <span class="c1"># 化合物名</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">graphname</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;$\mathrm{&quot;</span> <span class="o">+</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;(\d+\.*\d*)&quot;</span><span class="p">,</span> <span class="s2">&quot;_{</span><span class="se">\\</span><span class="s2">1}&quot;</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;}$&quot;</span> <span class="c1"># グラフで表示する名前</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">date</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="n">date</span> <span class="c1"># 合成した日付(必要ならナンバリングもここに含める)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">spacegroup_name</span><span class="p">:</span> <span class="nb">str</span>  <span class="c1"># 空間群名(国際表記)</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">NA</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">6.02214076e+23</span> <span class="c1"># Avogadro定数 [mol^-1]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">muB</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">9.27401e-21</span> <span class="c1"># Bohr磁子 [emu]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">kB</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">1.380649e-23</span> <span class="c1"># Boltzmann定数 [J/K]</span>
        
        <span class="c1"># 格子定数</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">a</span><span class="p">:</span> <span class="nb">float</span>              <span class="c1"># 格子定数 [Å]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">b</span><span class="p">:</span> <span class="nb">float</span>              <span class="c1"># 格子定数 [Å]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">c</span><span class="p">:</span> <span class="nb">float</span>              <span class="c1"># 格子定数 [Å]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">alpha</span><span class="p">:</span> <span class="nb">float</span>          <span class="c1"># 基本並進ベクトル間の角度 [°]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">beta</span><span class="p">:</span> <span class="nb">float</span>           <span class="c1"># 基本並進ベクトル間の角度 [°]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">gamma</span><span class="p">:</span> <span class="nb">float</span>          <span class="c1"># 基本並進ベクトル間の角度 [°]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">V</span><span class="p">:</span> <span class="nb">float</span>              <span class="c1"># 単位胞の体積 [cm^3]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Z</span><span class="p">:</span> <span class="nb">int</span>                <span class="c1"># 単位胞に含まれる式単位の数 (無次元)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">formula_weight</span><span class="p">:</span> <span class="nb">float</span> <span class="c1"># モル質量(式単位あたり) [g/mol]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">w</span><span class="p">:</span> <span class="nb">float</span>              <span class="c1"># 試料の質量 [g]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">num_magnetic_ion</span><span class="p">:</span> <span class="nb">int</span> <span class="c1"># 式単位中の磁性イオンの数 (無次元)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">density</span><span class="p">:</span> <span class="nb">float</span>        <span class="c1"># 密度 [g/cm^3]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mol</span><span class="p">:</span> <span class="nb">float</span>            <span class="c1"># 物質量 [mol]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">numbered_name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;([A-Z][a-z]?|\))(?=[^0-9a-z]+)&quot;</span><span class="p">,</span> <span class="sa">r</span><span class="s2">&quot;\g&lt;1&gt;1&quot;</span><span class="p">,</span> <span class="n">name</span><span class="o">+</span><span class="s2">&quot;$&quot;</span><span class="p">)[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="c1"># &#39;1&#39;を追加して元素数を明示したname (&quot;$&quot;は番兵)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">components</span><span class="p">:</span> <span class="n">defaultdict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span>   <span class="c1"># 式単位中に各元素がいくつあるか</span>

        <span class="c1"># 各インスタンス変数の単位</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">unit</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;NA&quot;</span><span class="p">:</span> <span class="s2">&quot;mol^-1&quot;</span><span class="p">,</span> <span class="s2">&quot;muB&quot;</span><span class="p">:</span> <span class="s2">&quot;emu&quot;</span><span class="p">,</span> <span class="s2">&quot;kB&quot;</span><span class="p">:</span> <span class="s2">&quot;J/K&quot;</span><span class="p">,</span>
            <span class="s2">&quot;a&quot;</span><span class="p">:</span> <span class="s2">&quot;Å&quot;</span><span class="p">,</span> <span class="s2">&quot;b&quot;</span><span class="p">:</span> <span class="s2">&quot;Å&quot;</span><span class="p">,</span> <span class="s2">&quot;c&quot;</span><span class="p">:</span> <span class="s2">&quot;Å&quot;</span><span class="p">,</span> <span class="s2">&quot;alpha&quot;</span><span class="p">:</span> <span class="s2">&quot;°&quot;</span><span class="p">,</span> <span class="s2">&quot;beta&quot;</span><span class="p">:</span> <span class="s2">&quot;°&quot;</span><span class="p">,</span> <span class="s2">&quot;gamma&quot;</span><span class="p">:</span> <span class="s2">&quot;°&quot;</span><span class="p">,</span>
            <span class="s2">&quot;V&quot;</span><span class="p">:</span> <span class="s2">&quot;cm^3&quot;</span><span class="p">,</span> <span class="s2">&quot;Z&quot;</span><span class="p">:</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="s2">&quot;formula_weight&quot;</span><span class="p">:</span> <span class="s2">&quot;g/mol&quot;</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">:</span> <span class="s2">&quot;g&quot;</span><span class="p">,</span> 
            <span class="s2">&quot;num_magnetic_ion&quot;</span><span class="p">:</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="s2">&quot;density&quot;</span><span class="p">:</span> <span class="s2">&quot;g/cm^3&quot;</span><span class="p">,</span> <span class="s2">&quot;mol&quot;</span><span class="p">:</span> <span class="s2">&quot;mol&quot;</span><span class="p">,</span>
        <span class="p">}</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">graphs</span><span class="p">:</span> <span class="n">SemimutableDict</span> <span class="o">=</span> <span class="n">SemimutableDict</span><span class="p">()</span>

        <span class="c1"># 化学式を&quot;形態素&quot;ごとに分割したリスト</span>
        <span class="n">divided_name</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;,+&quot;</span><span class="p">,</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;([A-Z][a-z]*|(\d|\.)+|[()])&quot;</span><span class="p">,</span> <span class="s2">&quot;,</span><span class="se">\\</span><span class="s2">1,&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">numbered_name</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s2">&quot;,&quot;</span><span class="p">))</span>
        <span class="n">now</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">1.0</span> <span class="c1"># 倍率</span>
        <span class="n">num_stack</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="mf">1.0</span><span class="p">]</span> <span class="c1"># 後ろから見て，現在有効な数の積を格納するstack</span>
        <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="nb">reversed</span><span class="p">(</span><span class="n">divided_name</span><span class="p">):</span> <span class="c1"># 化学式を後ろからみる</span>
            <span class="k">if</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;\d+\.*\d*&quot;</span><span class="p">,</span> <span class="n">s</span><span class="p">):</span> <span class="c1"># 小数表示を許した数値</span>
                <span class="n">now</span> <span class="o">*=</span> <span class="nb">float</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
                <span class="n">num_stack</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">s</span><span class="p">))</span>
            <span class="k">elif</span> <span class="n">s</span> <span class="o">==</span> <span class="s2">&quot;)&quot;</span><span class="p">:</span>
                <span class="k">pass</span>
            <span class="k">elif</span> <span class="n">s</span> <span class="o">==</span> <span class="s2">&quot;(&quot;</span><span class="p">:</span> <span class="c1"># ()を付けるときは必ず直後に1以上の数字が来る</span>
                <span class="n">now</span> <span class="o">/=</span> <span class="n">num_stack</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">components</span><span class="p">[</span><span class="n">s</span><span class="p">]</span> <span class="o">+=</span> <span class="n">now</span>
                <span class="n">now</span> <span class="o">/=</span> <span class="n">num_stack</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">auto_formula_weight</span><span class="p">:</span> <span class="c1"># nameから自動でモル質量を計算</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">formula_weight</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.0</span> <span class="c1"># モル質量(式単位あたり)</span>
                <span class="k">for</span> <span class="n">element</span><span class="p">,</span> <span class="n">n</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">components</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="n">element</span> <span class="ow">in</span> <span class="n">atomic_weight</span><span class="p">:</span>
                        <span class="k">raise</span> <span class="ne">KeyError</span>
                    <span class="n">formula_weight</span> <span class="o">+=</span> <span class="n">atomic_weight</span><span class="p">[</span><span class="n">element</span><span class="p">]</span> <span class="o">*</span> <span class="n">n</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">formula_weight</span> <span class="o">=</span> <span class="n">formula_weight</span>
            <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;&#39;name&#39; includes atom(s) whose atomic weight is undefined. please set &#39;formula_weight&#39; manually&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">:</span> <span class="n">Crystalchild</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="n">res</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__dict__</span><span class="p">:</span>
            <span class="n">v</span><span class="p">:</span> <span class="n">Any</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">k</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">v</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">k</span> <span class="o">==</span> <span class="s2">&quot;unit&quot;</span><span class="p">:</span>
                <span class="k">continue</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">k</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">unit</span><span class="p">:</span>
                <span class="n">res</span> <span class="o">=</span> <span class="n">res</span> <span class="o">+</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">k</span><span class="si">}</span><span class="s2"> = </span><span class="si">{</span><span class="n">v</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span>
            <span class="k">elif</span> <span class="nb">type</span><span class="p">(</span><span class="n">v</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">float</span><span class="p">:</span>
                <span class="n">res</span> <span class="o">=</span> <span class="n">res</span> <span class="o">+</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">k</span><span class="si">}</span><span class="s2"> = </span><span class="si">{</span><span class="n">v</span><span class="si">:</span><span class="s2">.5g</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">unit</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">res</span> <span class="o">=</span> <span class="n">res</span> <span class="o">+</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">k</span><span class="si">}</span><span class="s2"> = </span><span class="si">{</span><span class="n">v</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">unit</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span>
        <span class="k">return</span> <span class="n">res</span>

    <span class="k">def</span> <span class="fm">__add__</span><span class="p">(</span><span class="bp">self</span><span class="p">:</span> <span class="n">Crystalchild</span><span class="p">,</span> <span class="n">other</span><span class="p">:</span> <span class="n">Crystalchild</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Crystalchild</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">Crystal</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;unsupported operand type(s) for +:</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s2"> and </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">other</span><span class="p">)</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">+</span> <span class="n">other</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__mul__</span><span class="p">(</span><span class="bp">self</span><span class="p">:</span> <span class="n">Crystalchild</span><span class="p">,</span> <span class="n">other</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="nb">float</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Crystalchild</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">other</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="nb">int</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;unsupported operand type(s) for *:</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s2"> and </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">other</span><span class="p">)</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="c1"># 化学式をother倍する</span>
        <span class="n">divided_name</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;,+&quot;</span><span class="p">,</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;([A-Z][a-z]*|(\d|\.)+|[()])&quot;</span><span class="p">,</span> <span class="s2">&quot;,</span><span class="se">\\</span><span class="s2">1,&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">numbered_name</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s2">&quot;,&quot;</span><span class="p">))</span>
        <span class="n">parentheses_depth</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span> <span class="c1"># かっこの中にある数字は飛ばす</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">s</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">divided_name</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">s</span> <span class="o">==</span> <span class="s2">&quot;(&quot;</span><span class="p">:</span>
                <span class="n">parentheses_depth</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="k">elif</span> <span class="n">s</span> <span class="o">==</span> <span class="s2">&quot;)&quot;</span><span class="p">:</span>
                <span class="n">parentheses_depth</span> <span class="o">-=</span> <span class="mi">1</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">parentheses_depth</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;\d+\.*\d*&quot;</span><span class="p">,</span> <span class="n">s</span><span class="p">):</span>
                    <span class="n">divided_name</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="nb">float</span><span class="p">(</span><span class="n">s</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">other</span><span class="si">:</span><span class="s2">.4g</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">divided_name</span><span class="p">))</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">num_atom_per_formula_unit</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return the number of atom in a formula unit.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">sum</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">components</span><span class="o">.</span><span class="n">values</span><span class="p">()))</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">fu_per_unit_cell</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return the number of formula unit in a unit cell.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">Z</span>

<div class="viewcode-block" id="Crystal.set_lattice_constant"><a class="viewcode-back" href="../../../cpystal.core.html#cpystal.core.core.Crystal.set_lattice_constant">[docs]</a>    <span class="k">def</span> <span class="nf">set_lattice_constant</span><span class="p">(</span><span class="bp">self</span><span class="p">:</span> <span class="n">Crystalchild</span><span class="p">,</span> <span class="n">a</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">b</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">c</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">alpha</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">beta</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">gamma</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">Z</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Setting lattice constants of the crystal.</span>

<span class="sd">        Args:</span>
<span class="sd">            a (float): Lattice constant.</span>
<span class="sd">            b (float): Lattice constant.</span>
<span class="sd">            c (float): Lattice constant.</span>
<span class="sd">            alpha (float): Lattice constant.</span>
<span class="sd">            beta (float): Lattice constant.</span>
<span class="sd">            gamma (float): Lattice constant.</span>
<span class="sd">            Z (int | None): Number of formula unit in a unit cell.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># a,b,c: 格子定数 [Å]</span>
        <span class="c1"># alpha,beta,gamma: 基本並進ベクトル間の角度 [°]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">a</span> <span class="o">=</span> <span class="n">a</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">b</span> <span class="o">=</span> <span class="n">b</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">c</span> <span class="o">=</span> <span class="n">c</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">alpha</span> <span class="o">=</span> <span class="n">alpha</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">beta</span> <span class="o">=</span> <span class="n">beta</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">gamma</span> <span class="o">=</span> <span class="n">gamma</span>
        <span class="n">ca</span> <span class="o">=</span> <span class="n">cos</span><span class="p">(</span><span class="n">radians</span><span class="p">(</span><span class="n">alpha</span><span class="p">))</span>
        <span class="n">cb</span> <span class="o">=</span> <span class="n">cos</span><span class="p">(</span><span class="n">radians</span><span class="p">(</span><span class="n">beta</span><span class="p">))</span>
        <span class="n">cc</span> <span class="o">=</span> <span class="n">cos</span><span class="p">(</span><span class="n">radians</span><span class="p">(</span><span class="n">gamma</span><span class="p">))</span>
        <span class="c1"># 単位胞の体積 [cm^3]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">V</span> <span class="o">=</span> <span class="n">a</span><span class="o">*</span><span class="n">b</span><span class="o">*</span><span class="n">c</span> <span class="o">*</span> <span class="n">sqrt</span><span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="mi">2</span><span class="o">*</span><span class="n">ca</span><span class="o">*</span><span class="n">cb</span><span class="o">*</span><span class="n">cc</span> <span class="o">-</span> <span class="n">ca</span><span class="o">**</span><span class="mi">2</span> <span class="o">-</span> <span class="n">cb</span><span class="o">**</span><span class="mi">2</span> <span class="o">-</span> <span class="n">cc</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="mi">10</span><span class="o">**</span><span class="p">(</span><span class="o">-</span><span class="mi">24</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">Z</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Z</span> <span class="o">=</span> <span class="n">Z</span> <span class="c1"># 単位胞に含まれる式単位の数 (無次元)</span></div>
    
<div class="viewcode-block" id="Crystal.set_spacegroup_name"><a class="viewcode-back" href="../../../cpystal.core.html#cpystal.core.core.Crystal.set_spacegroup_name">[docs]</a>    <span class="k">def</span> <span class="nf">set_spacegroup_name</span><span class="p">(</span><span class="bp">self</span><span class="p">:</span> <span class="n">Crystalchild</span><span class="p">,</span> <span class="n">spacegroup_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Setting space group name of the crystal.</span>

<span class="sd">        Args:</span>
<span class="sd">            spacegroup_name (str): Space group name in International (Hermann-Mauguin) notation.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">spacegroup_name</span> <span class="o">=</span> <span class="n">spacegroup_name</span></div>

<div class="viewcode-block" id="Crystal.set_formula_weight"><a class="viewcode-back" href="../../../cpystal.core.html#cpystal.core.core.Crystal.set_formula_weight">[docs]</a>    <span class="k">def</span> <span class="nf">set_formula_weight</span><span class="p">(</span><span class="bp">self</span><span class="p">:</span> <span class="n">Crystalchild</span><span class="p">,</span> <span class="n">formula_weight</span><span class="p">:</span> <span class="nb">float</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Setting formula weight (per formula unit) of the crystal.</span>

<span class="sd">        Args:</span>
<span class="sd">            formula_weight (float): Weight of formula unit per mol (unit: [g/mol]).</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># コンストラクタでauto_formula_weight = Trueで自動設定可能</span>
        <span class="c1"># formula_weight: モル質量(式単位あたり) [g/mol]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">formula_weight</span> <span class="o">=</span> <span class="n">formula_weight</span></div>

<div class="viewcode-block" id="Crystal.set_weight"><a class="viewcode-back" href="../../../cpystal.core.html#cpystal.core.core.Crystal.set_weight">[docs]</a>    <span class="k">def</span> <span class="nf">set_weight</span><span class="p">(</span><span class="bp">self</span><span class="p">:</span> <span class="n">Crystalchild</span><span class="p">,</span> <span class="n">w</span><span class="p">:</span> <span class="nb">float</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Setting the weight of the sample.</span>

<span class="sd">        Args:</span>
<span class="sd">            w (float): The weight of the sample (unit: [g]).</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># w: 試料の質量 [g]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">w</span> <span class="o">=</span> <span class="n">w</span></div>
    
<div class="viewcode-block" id="Crystal.set_mol"><a class="viewcode-back" href="../../../cpystal.core.html#cpystal.core.core.Crystal.set_mol">[docs]</a>    <span class="k">def</span> <span class="nf">set_mol</span><span class="p">(</span><span class="bp">self</span><span class="p">:</span> <span class="n">Crystalchild</span><span class="p">,</span> <span class="n">mol</span><span class="p">:</span> <span class="nb">float</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Setting the amount of substance of the sample.</span>

<span class="sd">        Args:</span>
<span class="sd">            mol (float): The amount of substance of the sample (unit: [mol]).</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># mol: 試料の物質量 [mol]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mol</span> <span class="o">=</span> <span class="n">mol</span></div>

<div class="viewcode-block" id="Crystal.set_num_magnetic_ion"><a class="viewcode-back" href="../../../cpystal.core.html#cpystal.core.core.Crystal.set_num_magnetic_ion">[docs]</a>    <span class="k">def</span> <span class="nf">set_num_magnetic_ion</span><span class="p">(</span><span class="bp">self</span><span class="p">:</span> <span class="n">Crystalchild</span><span class="p">,</span> <span class="n">num_magnetic_ion</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Setting the number of magnetic ions in a formula unit.</span>

<span class="sd">        Args:</span>
<span class="sd">            num_magnetic_ion (float): Number of magnetic ions in a formula unit.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># num_magnetic_ion: 式単位中の磁性イオンの数 (無次元)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">num_magnetic_ion</span> <span class="o">=</span> <span class="n">num_magnetic_ion</span></div>

<div class="viewcode-block" id="Crystal.cal_density"><a class="viewcode-back" href="../../../cpystal.core.html#cpystal.core.core.Crystal.cal_density">[docs]</a>    <span class="k">def</span> <span class="nf">cal_density</span><span class="p">(</span><span class="bp">self</span><span class="p">:</span> <span class="n">Crystalchild</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Calculating the density of the crystal.</span>

<span class="sd">        Returns:</span>
<span class="sd">            (float): The density of the crystal (unit: [g/cm^3]).</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># formula_weight: モル質量(式単位あたり) [g/mol]</span>
        <span class="c1"># Z: 単位胞中の式単位数 (無次元)</span>
        <span class="c1"># V: 単位胞の体積 [cm^3]</span>
        <span class="c1"># density: 密度 [g/cm^3]</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">formula_weight</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">Z</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">V</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;one or more of the attributes are &#39;NoneType&#39;: &#39;formula_weight&#39;, &#39;Z&#39;, &#39;V&#39;&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">density</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">formula_weight</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">Z</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">NA</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">V</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">density</span></div>

<div class="viewcode-block" id="Crystal.cal_mol"><a class="viewcode-back" href="../../../cpystal.core.html#cpystal.core.core.Crystal.cal_mol">[docs]</a>    <span class="k">def</span> <span class="nf">cal_mol</span><span class="p">(</span><span class="bp">self</span><span class="p">:</span> <span class="n">Crystalchild</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Calculating the amount of substance of the sample from the weight of the sample.</span>

<span class="sd">        Returns:</span>
<span class="sd">            (float): The amount of substance of the sample (unit: [mol]).</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># formula_weight: モル質量(式単位あたり) [g/mol]</span>
        <span class="c1"># w: 試料の質量 [g]</span>
        <span class="c1"># mol: 試料の物質量 [mol]</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">formula_weight</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">w</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;one or more of the attributes are &#39;NoneType&#39;: &#39;formula_weight&#39;, &#39;w&#39;&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mol</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">w</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">formula_weight</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">mol</span></div>

<div class="viewcode-block" id="Crystal.cal_weight"><a class="viewcode-back" href="../../../cpystal.core.html#cpystal.core.core.Crystal.cal_weight">[docs]</a>    <span class="k">def</span> <span class="nf">cal_weight</span><span class="p">(</span><span class="bp">self</span><span class="p">:</span> <span class="n">Crystalchild</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Calculating the weight of the sample from the amount of substance of the sample.</span>

<span class="sd">        Returns:</span>
<span class="sd">            (float): The weight of the sample (unit: [g]).</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># formula_weight: モル質量(式単位あたり) [g/mol]</span>
        <span class="c1"># mol: 試料の物質量 [mol]</span>
        <span class="c1"># w: 試料の質量 [g]</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">formula_weight</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">mol</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;one or more of the attributes are &#39;NoneType&#39;: &#39;formula_weight&#39;, &#39;mol&#39;&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">w</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">formula_weight</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">mol</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">w</span></div>

<div class="viewcode-block" id="Crystal.cal_magnetization"><a class="viewcode-back" href="../../../cpystal.core.html#cpystal.core.core.Crystal.cal_magnetization">[docs]</a>    <span class="k">def</span> <span class="nf">cal_magnetization</span><span class="p">(</span><span class="bp">self</span><span class="p">:</span> <span class="n">Crystalchild</span><span class="p">,</span> <span class="n">m</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">w</span><span class="p">:</span> <span class="nb">float</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">SI</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">per</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Calculating magnetization from measured value of magnetic moment.</span>

<span class="sd">        Args:</span>
<span class="sd">            m (float): Magnetic moment (unit: [emu]).</span>
<span class="sd">            w (float | None): The weight of the sample (unit: [g]).</span>
<span class="sd">            SI (bool): If True, magnetization is calculated in SI (MKSA) system.</span>
<span class="sd">            per (str | None): If per == &quot;mol&quot;, magnetization per mol is calculated. If per == &quot;weight&quot;, magnetization per weight is calculated. </span>
<span class="sd">        </span>
<span class="sd">        Returns:</span>
<span class="sd">            (float): Magnetization (unit: [G], [G/mol], [G/g], [A/m], [A/m/mol] or [A/m/kg]).</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># m: 磁気モーメント [emu]</span>
        <span class="c1"># w: 試料の質量 [g]</span>
        <span class="c1"># density: 密度 [g/cm^3]</span>
        <span class="c1"># M: 磁化 [G] or [G/mol] or [A/m] or [A/(m mol)]</span>
        <span class="k">if</span> <span class="n">w</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">w</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">w</span>
        <span class="k">if</span> <span class="n">w</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">density</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">formula_weight</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;one or more of the attributes are &#39;NoneType&#39;: &#39;formula_weight&#39;, &#39;w&#39;, &#39;density&#39;&quot;</span><span class="p">)</span>
        <span class="n">M</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="n">m</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">density</span> <span class="o">/</span> <span class="n">w</span> <span class="c1"># [G] = [emu/cm^3]</span>
        <span class="k">if</span> <span class="n">SI</span><span class="p">:</span>
            <span class="n">M</span> <span class="o">*=</span> <span class="mi">10</span><span class="o">**</span><span class="mi">3</span> <span class="c1"># 1 G == 1000 A/m</span>
            <span class="k">if</span> <span class="n">per</span> <span class="o">==</span> <span class="s2">&quot;mol&quot;</span><span class="p">:</span> <span class="c1"># molあたり</span>
                <span class="n">M</span> <span class="o">*=</span> <span class="bp">self</span><span class="o">.</span><span class="n">formula_weight</span> <span class="o">/</span> <span class="n">w</span>
            <span class="k">elif</span> <span class="n">per</span> <span class="o">==</span> <span class="s2">&quot;weight&quot;</span><span class="p">:</span> <span class="c1"># kgあたり</span>
                <span class="n">M</span> <span class="o">*=</span> <span class="mi">1</span><span class="o">/</span><span class="n">w</span> <span class="o">*</span> <span class="mi">1000</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">per</span> <span class="o">==</span> <span class="s2">&quot;mol&quot;</span><span class="p">:</span> <span class="c1"># molあたり</span>
                <span class="n">M</span> <span class="o">*=</span> <span class="bp">self</span><span class="o">.</span><span class="n">formula_weight</span> <span class="o">/</span> <span class="n">w</span>
            <span class="k">elif</span> <span class="n">per</span> <span class="o">==</span> <span class="s2">&quot;weight&quot;</span><span class="p">:</span> <span class="c1"># gあたり</span>
                <span class="n">M</span> <span class="o">*=</span> <span class="mi">1</span><span class="o">/</span><span class="n">w</span>
        <span class="k">return</span> <span class="n">M</span></div>

<div class="viewcode-block" id="Crystal.cal_Bohr_per_formula_unit"><a class="viewcode-back" href="../../../cpystal.core.html#cpystal.core.core.Crystal.cal_Bohr_per_formula_unit">[docs]</a>    <span class="k">def</span> <span class="nf">cal_Bohr_per_formula_unit</span><span class="p">(</span><span class="bp">self</span><span class="p">:</span> <span class="n">Crystalchild</span><span class="p">,</span> <span class="n">m</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">w</span><span class="p">:</span> <span class="nb">float</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Calculating magnetization in units of Bohr magneton per formula unit.</span>

<span class="sd">        Args:</span>
<span class="sd">            m (float): Magnetic moment (unit: [emu]).</span>
<span class="sd">            w (float | None): The weight of the sample (unit: [g]).</span>
<span class="sd">        </span>
<span class="sd">        Returns:</span>
<span class="sd">            (float): Magnetization in units of Bohr magneton per formula unit.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">w</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">w</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">w</span>
        <span class="k">if</span> <span class="n">w</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">formula_weight</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;one or more of the attributes are &#39;NoneType&#39;: &#39;formula_weight&#39;, &#39;w&#39;&quot;</span><span class="p">)</span>
        <span class="c1"># 式単位あたりの有効Bohr磁子数 [μB/f.u.]</span>
        <span class="n">mu</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="p">(</span><span class="n">m</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">muB</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">w</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">formula_weight</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">NA</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">mu</span></div>

<div class="viewcode-block" id="Crystal.cal_Bohr_per_ion"><a class="viewcode-back" href="../../../cpystal.core.html#cpystal.core.core.Crystal.cal_Bohr_per_ion">[docs]</a>    <span class="k">def</span> <span class="nf">cal_Bohr_per_ion</span><span class="p">(</span><span class="bp">self</span><span class="p">:</span> <span class="n">Crystalchild</span><span class="p">,</span> <span class="n">m</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">w</span><span class="p">:</span> <span class="nb">float</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">num_magnetic_ion</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Calculating magnetization in units of Bohr magneton per magnetic ion.</span>

<span class="sd">        Args:</span>
<span class="sd">            m (float): Magnetic moment (unit: [emu]).</span>
<span class="sd">            w (float | None): The weight of the sample (unit: [g]).</span>
<span class="sd">            num_magnetic_ion (float | None): Number of magnetic ions in a formula unit.</span>
<span class="sd">        </span>
<span class="sd">        Returns:</span>
<span class="sd">            (float): Magnetization in units of Bohr magneton per magnetic ion.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">w</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">w</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">w</span>
        <span class="k">if</span> <span class="n">num_magnetic_ion</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">num_magnetic_ion</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">num_magnetic_ion</span>
        <span class="k">if</span> <span class="n">w</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">num_magnetic_ion</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">formula_weight</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;one or more of the attributes are &#39;NoneType&#39;: &#39;formula_weight&#39;, &#39;w&#39;, &#39;num_magnetic_ion&#39;&quot;</span><span class="p">)</span>
        <span class="c1"># 磁性イオンあたりの有効Bohr磁子数 [μB/ion]</span>
        <span class="n">mu</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="p">(</span><span class="n">m</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">muB</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">w</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">formula_weight</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">NA</span><span class="p">)</span> <span class="o">/</span> <span class="n">num_magnetic_ion</span>
        <span class="k">return</span> <span class="n">mu</span></div>

<div class="viewcode-block" id="Crystal.cal_ingredients"><a class="viewcode-back" href="../../../cpystal.core.html#cpystal.core.core.Crystal.cal_ingredients">[docs]</a>    <span class="k">def</span> <span class="nf">cal_ingredients</span><span class="p">(</span><span class="bp">self</span><span class="p">:</span> <span class="n">Crystalchild</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="nb">tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">float</span><span class="p">]]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Calculating the weight of each element in the sample.</span>

<span class="sd">        Returns:</span>
<span class="sd">            (list[tuple[str, float]]): list of tuple (element name, element weight ratio to the total).</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># selfに含まれる各元素の重量をそれぞれ求める</span>
        <span class="n">res</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">float</span><span class="p">]]</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">formula_weight</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;the attribute &#39;formula_weight&#39; is &#39;NoneType&#39;&quot;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">element</span><span class="p">,</span> <span class="n">n</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">components</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">res</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">element</span><span class="p">,</span> <span class="n">n</span><span class="o">*</span><span class="n">atomic_weight</span><span class="p">[</span><span class="n">element</span><span class="p">]</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">formula_weight</span><span class="p">))</span>
        <span class="n">res</span> <span class="o">=</span> <span class="n">res</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;The ingredients of </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2"> (</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">w</span><span class="si">}</span><span class="s2"> g):&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">w</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">element</span><span class="si">}</span><span class="s2"> = </span><span class="si">{</span><span class="n">ratio</span><span class="si">:</span><span class="s2">.2%</span><span class="si">}</span><span class="s2">&quot;</span> <span class="k">for</span> <span class="n">element</span><span class="p">,</span> <span class="n">ratio</span> <span class="ow">in</span> <span class="n">res</span><span class="p">]))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">element</span><span class="si">}</span><span class="s2"> = </span><span class="si">{</span><span class="n">ratio</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">w</span><span class="si">:</span><span class="s2">.4g</span><span class="si">}</span><span class="s2"> g (</span><span class="si">{</span><span class="n">ratio</span><span class="si">:</span><span class="s2">.2%</span><span class="si">}</span><span class="s2">)&quot;</span> <span class="k">for</span> <span class="n">element</span><span class="p">,</span> <span class="n">ratio</span> <span class="ow">in</span> <span class="n">res</span><span class="p">]))</span>
        <span class="k">return</span> <span class="n">res</span></div>

<div class="viewcode-block" id="Crystal.cal_Bpfu_to_emu"><a class="viewcode-back" href="../../../cpystal.core.html#cpystal.core.core.Crystal.cal_Bpfu_to_emu">[docs]</a>    <span class="k">def</span> <span class="nf">cal_Bpfu_to_emu</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mu</span><span class="p">:</span> <span class="nb">float</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Calculating &#39;emu&#39;-unit magnetization from the value of &#39;muB/f.u.&#39;-unit magnetization.</span>

<span class="sd">        Args:</span>
<span class="sd">            mu (float): &#39;muB/f.u.&#39;-unit magnetization.</span>
<span class="sd">        </span>
<span class="sd">        Returns:</span>
<span class="sd">            (float): &#39;emu&#39;-unit magnetization</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">mu</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">muB</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">w</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">formula_weight</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">NA</span></div>

<div class="viewcode-block" id="Crystal.cal_effective_moment"><a class="viewcode-back" href="../../../cpystal.core.html#cpystal.core.core.Crystal.cal_effective_moment">[docs]</a>    <span class="k">def</span> <span class="nf">cal_effective_moment</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">Curie_constant</span><span class="p">:</span> <span class="nb">float</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Calculating effective moment from the value of Curie constant.</span>

<span class="sd">        Note:</span>
<span class="sd">            C = Nμ^2/3kB</span>
<span class="sd">            μ^2 = g^2 J(J+1) μB^2</span>
<span class="sd">            where N is the number of magnetic ion per mol,</span>
<span class="sd">                g is Lande factor,</span>
<span class="sd">                J is total angular momentum quantum number.</span>
<span class="sd">            (emu*Oe = erg = 10^(-7) Joule)</span>

<span class="sd">        Args:</span>
<span class="sd">            Curie_constant (float): Curie constant (unit: [emu.K/mol.Oe]).</span>

<span class="sd">        Returns:</span>
<span class="sd">            (float): Effective moment μ/μB = g√J(J+1).</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="p">(</span><span class="n">Curie_constant</span> <span class="o">/</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">num_magnetic_ion</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">NA</span> <span class="o">/</span> <span class="mi">3</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">kB</span><span class="p">)</span> <span class="o">*</span> <span class="mi">10</span><span class="o">**</span><span class="mi">7</span><span class="p">)</span> <span class="o">**</span> <span class="mf">0.5</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">muB</span></div>

<div class="viewcode-block" id="Crystal.cal_phonon_velocity"><a class="viewcode-back" href="../../../cpystal.core.html#cpystal.core.core.Crystal.cal_phonon_velocity">[docs]</a>    <span class="k">def</span> <span class="nf">cal_phonon_velocity</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">TD</span><span class="p">:</span> <span class="nb">float</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Calculating phonon velocity from Debye temperature.</span>

<span class="sd">        Note:</span>
<span class="sd">            k_B T_D = \hbar \omega_D = \hbar v k_D,</span>
<span class="sd">            where Debye wave number k_D satifies 4/3 \pi k_D^3 = (2\pi)^3 N / V,</span>
<span class="sd">            where N is the number of atom in the sample and V is the volume of the sample.</span>

<span class="sd">        Args:</span>
<span class="sd">            TD (float): Debye temperature (unit: [K]).</span>
<span class="sd">        </span>
<span class="sd">        Returns:</span>
<span class="sd">            (float): Phonon velocity (unit: [cm/s]).</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">P</span><span class="p">:</span> <span class="n">PhysicalConstant</span> <span class="o">=</span> <span class="n">PhysicalConstant</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">P</span><span class="o">.</span><span class="n">kB</span> <span class="o">*</span> <span class="n">TD</span> <span class="o">/</span> <span class="n">P</span><span class="o">.</span><span class="n">hbar</span> <span class="o">*</span> <span class="p">(</span><span class="mi">6</span><span class="o">*</span><span class="n">P</span><span class="o">.</span><span class="n">pi</span><span class="o">**</span><span class="mi">2</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">num_atom_per_formula_unit</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">Z</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">V</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="o">/</span><span class="mi">3</span><span class="p">)</span> <span class="c1"># cm/s</span></div>

<div class="viewcode-block" id="Crystal.from_cif"><a class="viewcode-back" href="../../../cpystal.core.html#cpystal.core.core.Crystal.from_cif">[docs]</a>    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">from_cif</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">cif_filename</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Crystal</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Class method to make a `Crystal` instance from a cif file.</span>
<span class="sd">        </span>
<span class="sd">        Args:</span>
<span class="sd">            cif_filename (str): Input file name (if necessary, add file path to the head).</span>

<span class="sd">        Returns:</span>
<span class="sd">            (Crystalchild): `Crystal` instance made from the cif file `cif_filename`.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">cif_filename</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">lines</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">readlines</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">lines</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">line</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;_chemical_formula_structural&quot;</span><span class="p">):</span>
                <span class="n">name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;.+\&#39;(.+)\&#39;&quot;</span><span class="p">,</span> <span class="s2">&quot;</span><span class="se">\\</span><span class="s2">1&quot;</span><span class="p">,</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;_chemical_formula_structural&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">line</span><span class="p">))</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">rstrip</span><span class="p">()</span>
        <span class="n">res</span><span class="p">:</span> <span class="n">Crystal</span> <span class="o">=</span> <span class="bp">cls</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
        <span class="n">a</span><span class="p">:</span> <span class="nb">float</span>
        <span class="n">b</span><span class="p">:</span> <span class="nb">float</span>
        <span class="n">c</span><span class="p">:</span> <span class="nb">float</span>
        <span class="n">alpha</span><span class="p">:</span> <span class="nb">float</span>
        <span class="n">beta</span><span class="p">:</span> <span class="nb">float</span>
        <span class="n">gamma</span><span class="p">:</span> <span class="nb">float</span>
        <span class="n">Z</span><span class="p">:</span> <span class="nb">int</span>
        <span class="n">spacegroup_name</span><span class="p">:</span> <span class="nb">str</span>
        <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">lines</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">line</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;_cell_length_a &quot;</span><span class="p">):</span>
                <span class="n">a</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;\(.*\)&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">line</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;_cell_length_a &quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">rstrip</span><span class="p">())</span>
            <span class="k">if</span> <span class="n">line</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;_cell_length_b &quot;</span><span class="p">):</span>
                <span class="n">b</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;\(.*\)&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">line</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;_cell_length_b &quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">rstrip</span><span class="p">())</span>
            <span class="k">if</span> <span class="n">line</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;_cell_length_c &quot;</span><span class="p">):</span>
                <span class="n">c</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;\(.*\)&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">line</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;_cell_length_c &quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">rstrip</span><span class="p">())</span>
            <span class="k">if</span> <span class="n">line</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;_cell_angle_alpha &quot;</span><span class="p">):</span>
                <span class="n">alpha</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;\(.*\)&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">line</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;_cell_angle_alpha &quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">rstrip</span><span class="p">())</span>
            <span class="k">if</span> <span class="n">line</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;_cell_angle_beta &quot;</span><span class="p">):</span>
                <span class="n">beta</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;\(.*\)&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">line</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;_cell_angle_beta &quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">rstrip</span><span class="p">())</span>
            <span class="k">if</span> <span class="n">line</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;_cell_angle_gamma &quot;</span><span class="p">):</span>
                <span class="n">gamma</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;\(.*\)&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">line</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;_cell_angle_gamma &quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">rstrip</span><span class="p">())</span>
            <span class="k">if</span> <span class="n">line</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;_cell_formula_units_Z &quot;</span><span class="p">):</span>
                <span class="n">Z</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">line</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;_cell_formula_units_Z &quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">rstrip</span><span class="p">())</span>
            <span class="k">if</span> <span class="n">line</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;_space_group_name_H-M_alt&quot;</span><span class="p">):</span>
                <span class="n">spacegroup_name</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;_space_group_name_H-M_alt &quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">rstrip</span><span class="p">()</span>
        <span class="n">res</span><span class="o">.</span><span class="n">set_lattice_constant</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="n">alpha</span><span class="p">,</span> <span class="n">beta</span><span class="p">,</span> <span class="n">gamma</span><span class="p">,</span> <span class="n">Z</span><span class="p">)</span>
        <span class="n">res</span><span class="o">.</span><span class="n">spacegroup_name</span> <span class="o">=</span> <span class="n">spacegroup_name</span>
        <span class="k">return</span> <span class="n">res</span></div></div>

<span class="c1"># 型エイリアス</span>
<span class="n">LF</span> <span class="o">=</span> <span class="n">List</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span>
<span class="n">LLF</span> <span class="o">=</span> <span class="n">List</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">float</span><span class="p">]]</span>
<div class="viewcode-block" id="PPMSResistivity"><a class="viewcode-back" href="../../../cpystal.core.html#cpystal.core.core.PPMSResistivity">[docs]</a><span class="k">class</span> <span class="nc">PPMSResistivity</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;This is a class for acquiring experimental data of Physical Properties Measurement System (PPMS) from &#39;.dat&#39; files.</span>

<span class="sd">    Attributes:</span>
<span class="sd">        filename (str): Input file name (if necessary, add file path to the head). The suffix of `filename` may be &quot;.dat&quot;.</span>
<span class="sd">        material (Crystal | None): `Crystal` instance of the measurement object.</span>
<span class="sd">        Temp (list[float]): Temperature (K) data.</span>
<span class="sd">        Field (list[float]): Magnetic field (Oe) data.</span>
<span class="sd">        Time (list[float]): Time stamp (sec) data.</span>
<span class="sd">        B1Resistivity (list[float]): Bridge 1 Resistivity (Ohm) data.</span>
<span class="sd">        B2Resistivity (list[float]): Bridge 2 Resistivity (Ohm) data.</span>
<span class="sd">        B1R_sd (list[float]): Standard deviation of Bridge 1 Resistivity (Ohm) data.</span>
<span class="sd">        B2R_sd (list[float]): Standard deviation of Bridge 2 Resistivity (Ohm) data.</span>
<span class="sd">        B1Current (list[float]): Bridge 1 Current (μA) data.</span>
<span class="sd">        B2Current (list[float]): Bridge 2 Current (μA) data.</span>

<span class="sd">        (optional: when used `PPMS_Resistivity.set_S_l`)</span>
<span class="sd">        Sxx (float): Area of the sample perpendicular to the current (μm^2).</span>
<span class="sd">        Syx (float): Area of the sample parallel to the current (μm^2).</span>
<span class="sd">        lxx (float): Length of the sample parallel to the current (μm).</span>
<span class="sd">        lyx (float): Length of the sample perpendicular to the current (μm).</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">__near_abs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">k</span><span class="p">:</span> <span class="nb">float</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span> <span class="c1"># xに最も近いkの整数倍数</span>
        <span class="k">if</span> <span class="n">k</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span> <span class="mf">0.0</span>
        <span class="n">a</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">x</span><span class="o">/</span><span class="n">k</span><span class="p">)</span>
        <span class="k">return</span> <span class="nb">min</span><span class="p">([(</span><span class="n">a</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">k</span><span class="p">,</span> <span class="n">a</span><span class="o">*</span><span class="n">k</span><span class="p">,</span> <span class="p">(</span><span class="n">a</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">k</span><span class="p">],</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">y</span><span class="p">:</span><span class="nb">abs</span><span class="p">(</span><span class="n">x</span><span class="o">-</span><span class="n">y</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">_LSM</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">:</span> <span class="n">LF</span><span class="p">,</span> <span class="n">y</span><span class="p">:</span> <span class="n">LF</span><span class="p">,</span> <span class="n">linear</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="n">LF</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">]:</span> <span class="c1"># 最小二乗法</span>
        <span class="n">X</span><span class="p">:</span> <span class="n">Any</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
        <span class="n">Y</span><span class="p">:</span> <span class="n">Any</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">linear</span><span class="p">:</span> <span class="c1"># 線形関数近似</span>
            <span class="n">a</span> <span class="o">=</span> <span class="n">X</span><span class="nd">@Y</span> <span class="o">/</span> <span class="p">(</span><span class="n">X</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
            <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="n">a</span><span class="o">*</span><span class="n">X</span><span class="p">),</span> <span class="n">a</span><span class="p">,</span> <span class="mi">0</span>
        <span class="k">else</span><span class="p">:</span> <span class="c1"># 1次関数近似</span>
            <span class="n">n</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>
            <span class="n">xs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>
            <span class="n">Moment_sum</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">Y</span><span class="p">)</span>
            <span class="n">a</span> <span class="o">=</span> <span class="p">((</span><span class="n">X</span><span class="nd">@Y</span> <span class="o">-</span> <span class="n">xs</span><span class="o">*</span><span class="n">Moment_sum</span><span class="o">/</span><span class="n">n</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">X</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span> <span class="o">-</span> <span class="n">xs</span><span class="o">**</span><span class="mi">2</span><span class="o">/</span><span class="n">n</span><span class="p">))</span>
            <span class="n">b</span> <span class="o">=</span> <span class="p">(</span><span class="n">Moment_sum</span> <span class="o">-</span> <span class="n">a</span> <span class="o">*</span> <span class="n">xs</span><span class="p">)</span><span class="o">/</span><span class="n">n</span>
            <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="n">a</span><span class="o">*</span><span class="n">X</span> <span class="o">+</span> <span class="n">b</span><span class="p">),</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span>
    
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">material</span><span class="p">:</span> <span class="n">Crystal</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Initializer of `PPMS_Resistivity`.</span>

<span class="sd">        Args:</span>
<span class="sd">            filename (str): Input file name (if necessary, add file path to the head). The suffix of `filename` may be &quot;.dat&quot;.</span>
<span class="sd">            material (Crystal | None): `Crystal` instance of the measurement object.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">filename</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">filename</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">material</span><span class="p">:</span> <span class="n">Crystal</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="n">material</span>

        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s2">&quot;shift_jis&quot;</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;r&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">current_file</span><span class="p">:</span>
            <span class="n">label</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">data</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">list</span><span class="p">[</span><span class="n">Any</span><span class="p">]]</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">flag</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="n">current_file</span><span class="o">.</span><span class="n">readlines</span><span class="p">():</span>
                <span class="k">if</span> <span class="n">flag</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">l</span> <span class="o">==</span> <span class="s2">&quot;[Data]</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">:</span>
                    <span class="n">flag</span> <span class="o">=</span> <span class="mi">1</span>
                    <span class="k">continue</span>
                <span class="k">if</span> <span class="n">flag</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="n">label</span> <span class="o">=</span> <span class="n">l</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;,&quot;</span><span class="p">)</span>
                    <span class="n">flag</span> <span class="o">=</span> <span class="mi">2</span>
                <span class="k">elif</span> <span class="n">flag</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
                    <span class="n">data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="n">str_to_float</span><span class="p">,</span><span class="n">l</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;,&quot;</span><span class="p">))))</span>

        <span class="n">N</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>

        <span class="n">dict_label</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="n">v</span><span class="p">:</span><span class="n">k</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span><span class="n">v</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">label</span><span class="p">)}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Temp</span><span class="p">:</span> <span class="n">LF</span> <span class="o">=</span>          <span class="p">[</span><span class="n">data</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">dict_label</span><span class="p">[</span><span class="s2">&quot;Temperature (K)&quot;</span><span class="p">]]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">N</span><span class="p">)]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Field</span><span class="p">:</span> <span class="n">LF</span> <span class="o">=</span>         <span class="p">[</span><span class="n">data</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">dict_label</span><span class="p">[</span><span class="s2">&quot;Magnetic Field (Oe)&quot;</span><span class="p">]]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">N</span><span class="p">)]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Time</span><span class="p">:</span> <span class="n">LF</span> <span class="o">=</span>          <span class="p">[</span><span class="n">data</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">dict_label</span><span class="p">[</span><span class="s2">&quot;Time Stamp (sec)&quot;</span><span class="p">]]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">N</span><span class="p">)]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">B1Resistivity</span><span class="p">:</span> <span class="n">LF</span> <span class="o">=</span> <span class="p">[</span><span class="n">data</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">dict_label</span><span class="p">[</span><span class="s2">&quot;Bridge 1 Resistivity (Ohm)&quot;</span><span class="p">]]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">N</span><span class="p">)]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">B2Resistivity</span><span class="p">:</span> <span class="n">LF</span> <span class="o">=</span> <span class="p">[</span><span class="n">data</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">dict_label</span><span class="p">[</span><span class="s2">&quot;Bridge 2 Resistivity (Ohm)&quot;</span><span class="p">]]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">N</span><span class="p">)]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">B1R_sd</span><span class="p">:</span> <span class="n">LF</span> <span class="o">=</span>        <span class="p">[</span><span class="n">data</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">dict_label</span><span class="p">[</span><span class="s2">&quot;Bridge 1 Std. Dev. (Ohm)&quot;</span><span class="p">]]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">N</span><span class="p">)]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">B2R_sd</span><span class="p">:</span> <span class="n">LF</span> <span class="o">=</span>        <span class="p">[</span><span class="n">data</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">dict_label</span><span class="p">[</span><span class="s2">&quot;Bridge 2 Std. Dev. (Ohm)&quot;</span><span class="p">]]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">N</span><span class="p">)]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">B1Current</span><span class="p">:</span> <span class="n">LF</span> <span class="o">=</span>     <span class="p">[</span><span class="n">data</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">dict_label</span><span class="p">[</span><span class="s2">&quot;Bridge 1 Excitation (uA)&quot;</span><span class="p">]]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">N</span><span class="p">)]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">B2Current</span><span class="p">:</span> <span class="n">LF</span> <span class="o">=</span>     <span class="p">[</span><span class="n">data</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">dict_label</span><span class="p">[</span><span class="s2">&quot;Bridge 2 Excitation (uA)&quot;</span><span class="p">]]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">N</span><span class="p">)]</span>


<div class="viewcode-block" id="PPMSResistivity.set_S_l"><a class="viewcode-back" href="../../../cpystal.core.html#cpystal.core.core.PPMSResistivity.set_S_l">[docs]</a>    <span class="k">def</span> <span class="nf">set_S_l</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">Sxx</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">lxx</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">Syx</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">lyx</span><span class="p">:</span> <span class="nb">float</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span> <span class="c1"># S:[μm^2], l:[μm]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Sxx</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="n">Sxx</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Syx</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="n">Syx</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lxx</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="n">lxx</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lyx</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="n">lyx</span></div>
    
<div class="viewcode-block" id="PPMSResistivity.symmetrize"><a class="viewcode-back" href="../../../cpystal.core.html#cpystal.core.core.PPMSResistivity.symmetrize">[docs]</a>    <span class="k">def</span> <span class="nf">symmetrize</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">delta_H</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">up_data</span><span class="p">:</span> <span class="n">LLF</span><span class="p">,</span> <span class="n">down_data</span><span class="p">:</span> <span class="n">LLF</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="n">LF</span><span class="p">,</span> <span class="n">LF</span><span class="p">,</span> <span class="n">LF</span><span class="p">,</span> <span class="n">LF</span><span class="p">,</span> <span class="n">LF</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Symmetrization and antisymmetrization are performed based on the data of the field-increasing and field-decreasing processes.</span>

<span class="sd">        Args:</span>
<span class="sd">            delta_H (float): Difference of the magnetic field between each step.</span>
<span class="sd">            up_data (list[list[float]]): list of [field (float), Rxx (float), Rxx_sd (float), Ryx (float), Ryx_sd (float)] which represents field-increasing data.</span>
<span class="sd">            down_data (list[list[float]]): list of [field (float), Rxx (float), Rxx_sd (float), Ryx (float), Ryx_sd (float)] which represents field-decreasing data.</span>

<span class="sd">        Returns:</span>
<span class="sd">            (tuple[list[float], list[float], list[float]], list[float], list[float]): </span>
<span class="sd">                The first element of return value is &#39;effective_field&#39; that is the list of field value whose reverse field value exists in data.</span>
<span class="sd">                The second and third element of return value is the list of Rxx and Rxx_sd.</span>
<span class="sd">                The fourth and fifth element of return value is the list of Ryx and Ryx_sd.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="c1"># (up/down)_data := list[list[field: float, Rxx: float, Rxx_sd: float, Ryx: float, Ryx_sd: float]]</span>
        <span class="c1"># 磁場を1往復させたときのデータから，Rxx・Ryxをそれぞれ対称化・反対称化</span>

        <span class="n">up_idx</span><span class="p">:</span>   <span class="nb">dict</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="bp">self</span><span class="o">.</span><span class="n">__near_abs</span><span class="p">(</span><span class="n">h</span><span class="p">,</span> <span class="n">delta_H</span><span class="p">):</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="p">(</span><span class="n">h</span><span class="p">,</span> <span class="o">*</span><span class="n">_</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">up_data</span><span class="p">)}</span>
        <span class="n">down_idx</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="bp">self</span><span class="o">.</span><span class="n">__near_abs</span><span class="p">(</span><span class="o">-</span><span class="n">h</span><span class="p">,</span> <span class="n">delta_H</span><span class="p">):</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="p">(</span><span class="n">h</span><span class="p">,</span> <span class="o">*</span><span class="n">_</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">down_data</span><span class="p">)}</span>
        
        <span class="n">effective_field</span><span class="p">:</span> <span class="n">LF</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">Rxx</span><span class="p">:</span> <span class="n">LF</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">Ryx</span><span class="p">:</span> <span class="n">LF</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="n">Rxx_sd</span><span class="p">:</span> <span class="n">LF</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">Ryx_sd</span><span class="p">:</span> <span class="n">LF</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">for</span> <span class="n">h</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">down_idx</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span> <span class="o">&amp;</span> <span class="nb">set</span><span class="p">(</span><span class="n">up_idx</span><span class="o">.</span><span class="n">keys</span><span class="p">())):</span>
            <span class="n">i</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="n">up_idx</span><span class="p">[</span><span class="n">h</span><span class="p">]</span>
            <span class="n">j</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="n">down_idx</span><span class="p">[</span><span class="n">h</span><span class="p">]</span>
            <span class="n">effective_field</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">h</span><span class="p">)</span>
            <span class="n">_</span><span class="p">,</span> <span class="n">Rxx_i</span><span class="p">,</span> <span class="n">Rxx_sd_i</span><span class="p">,</span> <span class="n">Ryx_i</span><span class="p">,</span> <span class="n">Ryx_sd_i</span> <span class="o">=</span> <span class="n">up_data</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
            <span class="n">_</span><span class="p">,</span> <span class="n">Rxx_j</span><span class="p">,</span> <span class="n">Rxx_sd_j</span><span class="p">,</span> <span class="n">Ryx_j</span><span class="p">,</span> <span class="n">Ryx_sd_j</span> <span class="o">=</span> <span class="n">down_data</span><span class="p">[</span><span class="n">j</span><span class="p">]</span>
            <span class="c1"># 対称化・反対称化</span>
            <span class="n">Rxx</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="p">(</span><span class="n">Rxx_i</span><span class="o">+</span><span class="n">Rxx_j</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span> <span class="p">)</span> <span class="c1"># [Ω]</span>
            <span class="n">Ryx</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="p">(</span><span class="n">Ryx_i</span><span class="o">-</span><span class="n">Ryx_j</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span> <span class="p">)</span> <span class="c1"># [Ω]</span>
            <span class="c1"># 標準偏差の伝播則</span>
            <span class="n">Rxx_sd</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="p">(</span><span class="n">Rxx_sd_i</span><span class="o">**</span><span class="mi">2</span><span class="o">+</span><span class="n">Rxx_sd_j</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">**</span><span class="mf">0.5</span> <span class="o">/</span> <span class="mi">2</span> <span class="p">)</span> <span class="c1"># [Ω]</span>
            <span class="n">Ryx_sd</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="p">(</span><span class="n">Ryx_sd_i</span><span class="o">**</span><span class="mi">2</span><span class="o">+</span><span class="n">Ryx_sd_j</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">**</span><span class="mf">0.5</span> <span class="o">/</span> <span class="mi">2</span> <span class="p">)</span> <span class="c1"># [Ω]</span>
        <span class="k">return</span> <span class="n">effective_field</span><span class="p">,</span> <span class="n">Rxx</span><span class="p">,</span> <span class="n">Rxx_sd</span><span class="p">,</span> <span class="n">Ryx</span><span class="p">,</span> <span class="n">Ryx_sd</span></div></div>
                    

<div class="viewcode-block" id="MPMS"><a class="viewcode-back" href="../../../cpystal.core.html#cpystal.core.core.MPMS">[docs]</a><span class="k">class</span> <span class="nc">MPMS</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;This is a class for acquiring experimental data of Magnetic Property Measurement System (MPMS) from &#39;.dat&#39; files.</span>
<span class="sd">    </span>
<span class="sd">    Attributes:</span>
<span class="sd">        filename (str): Input file name (if necessary, add file path to the head). The suffix of `filename` may be &quot;.dat&quot;.</span>
<span class="sd">        material (Crystal | None): `Crystal` instance of the measurement object.</span>
<span class="sd">        N (int): Length of data.</span>
<span class="sd">        Temp (list[float]): Temperature (K) data.</span>
<span class="sd">        Field (list[float]): Magnetic field (Oe) data.</span>
<span class="sd">        Time (list[float]): Time stamp (sec) data.</span>
<span class="sd">        LongMoment (list[float]): Longitudinal moment (emu) data.</span>
<span class="sd">        Regfit (list[float]): Regression fit of longitudinal moment data.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">material</span><span class="p">:</span> <span class="n">Crystal</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Initializer of `MPMS`.</span>

<span class="sd">        Args:</span>
<span class="sd">            filename (str): Input file name (if necessary, add file path to the head). The suffix of `filename` may be &quot;.dat&quot;.</span>
<span class="sd">            material (Crystal): `Crystal` instance of the measurement object.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">filename</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">filename</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">material</span><span class="p">:</span> <span class="n">Crystal</span> <span class="o">=</span> <span class="n">material</span>

        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s2">&quot;shift_jis&quot;</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;r&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">current_file</span><span class="p">:</span>
            <span class="n">label</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">data</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">list</span><span class="p">[</span><span class="n">Any</span><span class="p">]]</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">flag</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="n">current_file</span><span class="o">.</span><span class="n">readlines</span><span class="p">():</span>
                <span class="k">if</span> <span class="n">flag</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">l</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;[Data]&quot;</span><span class="p">):</span>
                    <span class="n">flag</span> <span class="o">=</span> <span class="mi">1</span>
                    <span class="k">continue</span>
                <span class="k">if</span> <span class="n">flag</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="n">label</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;,\t*&quot;</span><span class="p">,</span> <span class="n">l</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span>
                    <span class="n">flag</span> <span class="o">=</span> <span class="mi">2</span>
                <span class="k">elif</span> <span class="n">flag</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
                    <span class="n">data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="n">str_to_float</span><span class="p">,</span> <span class="n">re</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;,\t*&quot;</span><span class="p">,</span> <span class="n">l</span><span class="o">.</span><span class="n">strip</span><span class="p">()))))</span>

        <span class="n">N</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>

        <span class="n">dict_label</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="n">v</span><span class="p">:</span><span class="n">k</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span><span class="n">v</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">label</span><span class="p">)}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">N</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="n">N</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Temp</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span>          <span class="p">[</span><span class="n">data</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">dict_label</span><span class="p">[</span><span class="s2">&quot;Temperature (K)&quot;</span><span class="p">]]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">N</span><span class="p">)]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Field</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span>         <span class="p">[</span><span class="n">data</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">dict_label</span><span class="p">[</span><span class="s2">&quot;Field (Oe)&quot;</span><span class="p">]]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">N</span><span class="p">)]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Time</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span>          <span class="p">[</span><span class="n">data</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">dict_label</span><span class="p">[</span><span class="s2">&quot;Time&quot;</span><span class="p">]]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">N</span><span class="p">)]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">LongMoment</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span>    <span class="p">[</span><span class="n">data</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">dict_label</span><span class="p">[</span><span class="s2">&quot;Long Moment (emu)&quot;</span><span class="p">]]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">N</span><span class="p">)]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">RegFit</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span>        <span class="p">[</span><span class="n">data</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">dict_label</span><span class="p">[</span><span class="s2">&quot;Long Reg Fit&quot;</span><span class="p">]]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">N</span><span class="p">)]</span>

    <span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="n">res</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">res</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;----------------------------&quot;</span><span class="p">)</span>
        <span class="n">res</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;idx, Temp, Field, LongMoment&quot;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">N</span><span class="p">):</span>
            <span class="n">res</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">Temp</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">Field</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">LongMoment</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">res</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;----------------------------&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">res</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Any</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
            <span class="k">return</span> <span class="p">[</span><span class="n">key</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">Temp</span><span class="p">[</span><span class="n">key</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">Field</span><span class="p">[</span><span class="n">key</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">LongMoment</span><span class="p">[</span><span class="n">key</span><span class="p">]]</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="nb">slice</span><span class="p">):</span>
            <span class="n">start</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="n">stop</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">N</span>
            <span class="n">step</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span>
            <span class="k">if</span> <span class="n">key</span><span class="o">.</span><span class="n">start</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">start</span> <span class="o">=</span> <span class="n">key</span><span class="o">.</span><span class="n">start</span>
            <span class="k">if</span> <span class="n">key</span><span class="o">.</span><span class="n">stop</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">stop</span> <span class="o">=</span> <span class="n">key</span><span class="o">.</span><span class="n">stop</span>
            <span class="k">if</span> <span class="n">key</span><span class="o">.</span><span class="n">step</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">step</span> <span class="o">=</span> <span class="n">key</span><span class="o">.</span><span class="n">step</span>
            <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">start</span><span class="p">,</span><span class="n">stop</span><span class="p">,</span><span class="n">step</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">Temp</span><span class="p">[</span><span class="n">key</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">Field</span><span class="p">[</span><span class="n">key</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">LongMoment</span><span class="p">[</span><span class="n">key</span><span class="p">]))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">KeyError</span><span class="p">(</span><span class="s2">&quot;key must be &#39;int&#39; or &#39;slice&#39;&quot;</span><span class="p">)</span>

<div class="viewcode-block" id="MPMS.cal_Curie_Weiss_temp"><a class="viewcode-back" href="../../../cpystal.core.html#cpystal.core.core.MPMS.cal_Curie_Weiss_temp">[docs]</a>    <span class="k">def</span> <span class="nf">cal_Curie_Weiss_temp</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">temp</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">float</span><span class="p">],</span> <span class="n">moment</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">float</span><span class="p">],</span> <span class="n">field</span><span class="p">:</span> <span class="nb">float</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Calculating Curie-Weiss temperature and Curie constant.</span>

<span class="sd">        Note:</span>
<span class="sd">            χ = M/H = C / (T-θc), where θc is Curie-Weiss temperature and C is Curie constant</span>

<span class="sd">        Args:</span>
<span class="sd">            temp (list[float]): list of temperature (K). Elements must be above Curie (or Neel) temperature.</span>
<span class="sd">            moment (list[float]): list of magnetic moment (emu).</span>

<span class="sd">        Returns:</span>
<span class="sd">            (tuple[float, float]): Curie-Weiss temperature (K) and Curie constant (emu.K/mol.Oe).</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">material</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">TypeError</span>
        <span class="n">Temp</span><span class="p">:</span> <span class="n">npt</span><span class="o">.</span><span class="n">NDArray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">temp</span><span class="p">)</span>
        <span class="n">sus_inv</span><span class="p">:</span> <span class="n">npt</span><span class="o">.</span><span class="n">NDArray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">field</span> <span class="o">/</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">moment</span><span class="p">)</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">material</span><span class="o">.</span><span class="n">mol</span><span class="p">))</span>
        <span class="n">n</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">Temp</span><span class="p">)</span>
        <span class="n">Temp_sum</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">Temp</span><span class="p">)</span>
        <span class="n">susinv_sum</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">sus_inv</span><span class="p">)</span>
        <span class="n">a</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="p">((</span><span class="n">Temp</span><span class="nd">@sus_inv</span> <span class="o">-</span> <span class="n">Temp_sum</span><span class="o">*</span><span class="n">susinv_sum</span><span class="o">/</span><span class="n">n</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">Temp</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span> <span class="o">-</span> <span class="n">Temp_sum</span><span class="o">**</span><span class="mi">2</span><span class="o">/</span><span class="n">n</span><span class="p">))</span>
        <span class="n">b</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="p">(</span><span class="n">susinv_sum</span> <span class="o">-</span> <span class="n">a</span> <span class="o">*</span> <span class="n">Temp_sum</span><span class="p">)</span><span class="o">/</span><span class="n">n</span>
        <span class="n">theta_Curie_Weiss</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="o">-</span><span class="p">(</span><span class="n">b</span><span class="o">/</span><span class="n">a</span><span class="p">)</span>
        <span class="n">Curie_constant</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mi">1</span><span class="o">/</span><span class="n">a</span>
        <span class="k">return</span> <span class="n">theta_Curie_Weiss</span><span class="p">,</span> <span class="n">Curie_constant</span></div>

<div class="viewcode-block" id="MPMS.Bpfu"><a class="viewcode-back" href="../../../cpystal.core.html#cpystal.core.core.MPMS.Bpfu">[docs]</a>    <span class="k">def</span> <span class="nf">Bpfu</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="nb">float</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Moment list in &#39;μB/f.u.&#39;.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">material</span><span class="o">.</span><span class="n">cal_Bohr_per_formula_unit</span><span class="p">(</span><span class="n">m</span><span class="p">)</span> <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">LongMoment</span><span class="p">]</span></div>

<div class="viewcode-block" id="MPMS.Field_T"><a class="viewcode-back" href="../../../cpystal.core.html#cpystal.core.core.MPMS.Field_T">[docs]</a>    <span class="k">def</span> <span class="nf">Field_T</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="nb">float</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Field list in &#39;Testa&#39;.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">f</span><span class="o">/</span><span class="mi">10000</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">Field</span><span class="p">]</span></div>

<div class="viewcode-block" id="MPMS.Susceptibility"><a class="viewcode-back" href="../../../cpystal.core.html#cpystal.core.core.MPMS.Susceptibility">[docs]</a>    <span class="k">def</span> <span class="nf">Susceptibility</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">H</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">magnification</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">1.0</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="nb">float</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;χ=M/H list in &#39;emu/mol.Oe&#39;.</span>

<span class="sd">        Args:</span>
<span class="sd">            H (float): Magnetic field (Oe).</span>
<span class="sd">            magnification (float): Amplification magnification. Defaults to 1.0.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">magnification</span> <span class="o">*</span> <span class="n">m</span> <span class="o">*</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">material</span><span class="o">.</span><span class="n">formula_weight</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">material</span><span class="o">.</span><span class="n">w</span><span class="p">)</span> <span class="o">/</span> <span class="n">H</span> <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">LongMoment</span><span class="p">]</span></div>
    
<div class="viewcode-block" id="MPMS.inv_Susceptibility"><a class="viewcode-back" href="../../../cpystal.core.html#cpystal.core.core.MPMS.inv_Susceptibility">[docs]</a>    <span class="k">def</span> <span class="nf">inv_Susceptibility</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">H</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">magnification</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">1.0</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="nb">float</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;1/χ=H/M list in &#39;(emu/mol.Oe)^{-1}&#39;.</span>

<span class="sd">        Args:</span>
<span class="sd">            H (float): Magnetic field (Oe).</span>
<span class="sd">            magnification (float): Amplification magnification. Defaults to 1.0.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">magnification</span> <span class="o">*</span> <span class="mi">1</span><span class="o">/</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">Susceptibility</span><span class="p">(</span><span class="n">H</span><span class="p">)]</span></div></div>


<span class="n">Energychild</span> <span class="o">=</span> <span class="n">TypeVar</span><span class="p">(</span><span class="s1">&#39;Energychild&#39;</span><span class="p">,</span> <span class="n">bound</span><span class="o">=</span><span class="s1">&#39;Energy&#39;</span><span class="p">)</span>

<div class="viewcode-block" id="Energy"><a class="viewcode-back" href="../../../cpystal.core.html#cpystal.core.core.Energy">[docs]</a><span class="k">class</span> <span class="nc">Energy</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;from energy to other physical quantity or vice versa.</span>

<span class="sd">    Note:</span>
<span class="sd">        All units stand for SI.</span>

<span class="sd">    Args:</span>
<span class="sd">        quantity (float): Quantity part of a physical quantity.</span>
<span class="sd">        unit (str): Unit part of a physical quantity.</span>
<span class="sd">    </span>
<span class="sd">    Example:</span>
<span class="sd">        1 meV -&gt; 11.6 K</span>
<span class="sd">        1 THz -&gt; 4.14 meV</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">quantity</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">unit</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">quantity</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="n">quantity</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">unit</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">unit</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">c</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mi">299792458</span> <span class="c1"># m/s</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">kB</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">1.380649e-23</span> <span class="c1"># J/K</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">e</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">1.602176634e-19</span> <span class="c1"># C</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">h</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">6.62607015e-34</span> <span class="c1"># Js</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">NA</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">6.02214076e23</span> <span class="c1"># mol^-1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">hbar</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">h</span><span class="o">/</span><span class="mi">2</span><span class="o">/</span><span class="n">pi</span> <span class="c1"># Js</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">me</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">9.1093837015e-31</span> <span class="c1"># kg</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">muB</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">hbar</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">e</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">me</span> <span class="o">/</span> <span class="mi">2</span> <span class="c1"># J/T</span>

        <span class="c1"># 数値の単位は [unit/meV]</span>
        <span class="c1"># eV, hν, hck, kBT, muBH</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mapping</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;meV&quot;</span><span class="p">:</span> <span class="mf">1.</span><span class="p">,</span>
            <span class="s2">&quot;THz&quot;</span><span class="p">:</span>  <span class="p">(</span><span class="mf">1e-3</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">e</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">h</span><span class="o">*</span><span class="mf">1e12</span><span class="p">),</span>
            <span class="s2">&quot;cm^-1&quot;</span><span class="p">:</span> <span class="p">(</span><span class="mf">1e-3</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">e</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="mf">1e2</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">h</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">c</span><span class="p">),</span>
            <span class="s2">&quot;A^-1&quot;</span><span class="p">:</span> <span class="p">(</span><span class="mf">1e-3</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">e</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="mf">1e10</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">h</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">c</span><span class="p">),</span>
            <span class="s2">&quot;K&quot;</span><span class="p">:</span>    <span class="p">(</span><span class="mf">1e-3</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">e</span><span class="p">)</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">kB</span><span class="p">,</span>
            <span class="s2">&quot;T&quot;</span><span class="p">:</span>    <span class="p">(</span><span class="mf">1e-3</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">e</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">muB</span><span class="p">),</span>
            <span class="s2">&quot;J&quot;</span><span class="p">:</span>    <span class="p">(</span><span class="mf">1e-3</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">e</span><span class="p">)</span>
        <span class="p">}</span>

    <span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">quantity</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">unit</span><span class="si">}</span><span class="s2">&quot;</span>
    
    <span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">quantity</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">unit</span><span class="si">}</span><span class="s2">&quot;</span>

    <span class="k">def</span> <span class="fm">__add__</span><span class="p">(</span><span class="bp">self</span><span class="p">:</span> <span class="n">Energychild</span><span class="p">,</span> <span class="n">other</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Energychild</span><span class="p">:</span>
        <span class="n">new_quantity</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">quantity</span> <span class="o">+</span> <span class="n">other</span><span class="o">.</span><span class="n">quantity</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">mapping</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">unit</span><span class="p">]</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">mapping</span><span class="p">[</span><span class="n">other</span><span class="o">.</span><span class="n">unit</span><span class="p">]</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="p">(</span><span class="n">new_quantity</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">unit</span><span class="p">)</span>
    
    <span class="k">def</span> <span class="fm">__iadd__</span><span class="p">(</span><span class="bp">self</span><span class="p">:</span> <span class="n">Energychild</span><span class="p">,</span> <span class="n">other</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Energychild</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">quantity</span> <span class="o">+=</span> <span class="n">other</span><span class="o">.</span><span class="n">quantity</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">mapping</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">unit</span><span class="p">]</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">mapping</span><span class="p">[</span><span class="n">other</span><span class="o">.</span><span class="n">unit</span><span class="p">]</span>
        <span class="k">return</span> <span class="bp">self</span>
    
    <span class="k">def</span> <span class="fm">__mul__</span><span class="p">(</span><span class="bp">self</span><span class="p">:</span> <span class="n">Energychild</span><span class="p">,</span> <span class="n">other</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Energychild</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">quantity</span> <span class="o">*</span> <span class="n">other</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">unit</span><span class="p">)</span>
    
    <span class="k">def</span> <span class="fm">__rmul__</span><span class="p">(</span><span class="bp">self</span><span class="p">:</span> <span class="n">Energychild</span><span class="p">,</span> <span class="n">other</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Energychild</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">quantity</span> <span class="o">*</span> <span class="n">other</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">unit</span><span class="p">)</span>
    
    <span class="k">def</span> <span class="fm">__imul__</span><span class="p">(</span><span class="bp">self</span><span class="p">:</span> <span class="n">Energychild</span><span class="p">,</span> <span class="n">other</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Energychild</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">quantity</span> <span class="o">*=</span> <span class="n">other</span>
        <span class="k">return</span> <span class="bp">self</span>

<div class="viewcode-block" id="Energy.to"><a class="viewcode-back" href="../../../cpystal.core.html#cpystal.core.core.Energy.to">[docs]</a>    <span class="k">def</span> <span class="nf">to</span><span class="p">(</span><span class="bp">self</span><span class="p">:</span> <span class="n">Energychild</span><span class="p">,</span> <span class="n">new_unit</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Energychild</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Translate the physical quantity as other units.</span>

<span class="sd">        Args:</span>
<span class="sd">            new_unit (str): New unit.</span>

<span class="sd">        Example:</span>
<span class="sd">            1 meV -&gt; 11.6 K</span>
<span class="sd">            1 THz -&gt; 4.14 meV</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">new_unit</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">mapping</span><span class="p">:</span>
            <span class="n">new_quantity</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">quantity</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">mapping</span><span class="p">[</span><span class="n">new_unit</span><span class="p">]</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">mapping</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">unit</span><span class="p">]</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="p">(</span><span class="n">new_quantity</span><span class="p">,</span> <span class="n">new_unit</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;the argument &#39;new_unit&#39; is invalid.&quot;</span><span class="p">)</span></div></div>


<div class="viewcode-block" id="ingredient_flake_dp"><a class="viewcode-back" href="../../../cpystal.core.html#cpystal.core.core.ingredient_flake_dp">[docs]</a><span class="k">def</span> <span class="nf">ingredient_flake_dp</span><span class="p">(</span><span class="n">A</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">int</span><span class="p">],</span> <span class="n">W</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span> <span class="c1"># A: 適当に整数化したフレークの重さ, W: 目標重量</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Choose optimal flakes whose total weight meets the target value.</span>

<span class="sd">    Note:</span>
<span class="sd">        The result will be output to stdout.</span>

<span class="sd">    Args:</span>
<span class="sd">        A (list[int]): list of weight of flakes, properly integerized.</span>
<span class="sd">        W (int): Target weight value.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">N</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">A</span><span class="p">)</span>
    <span class="n">K</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="n">W</span><span class="o">+</span><span class="mi">20</span> <span class="c1"># 余裕を持って求めておく</span>
    <span class="n">dp</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">list</span><span class="p">[</span><span class="nb">int</span><span class="p">]]</span> <span class="o">=</span> <span class="p">[[</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="n">K</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">N</span><span class="o">+</span><span class="mi">1</span><span class="p">)]</span>
    <span class="n">dp</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">N</span><span class="o">+</span><span class="mi">1</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">K</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">dp</span><span class="p">[</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="n">j</span><span class="p">]</span> <span class="ow">and</span> <span class="n">A</span><span class="p">[</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="n">j</span><span class="o">&lt;</span><span class="n">K</span><span class="p">:</span>
                <span class="n">dp</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">A</span><span class="p">[</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
            <span class="k">if</span> <span class="n">dp</span><span class="p">[</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="n">j</span><span class="p">]:</span>
                <span class="n">dp</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>

    <span class="c1">#print([i for i in range(K) if dp[N][i]])</span>
    <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="o">-</span><span class="mi">10</span><span class="p">,</span><span class="mi">11</span><span class="p">):</span> <span class="c1"># 目標値のまわり±10を見る</span>
        <span class="n">now</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="n">W</span><span class="o">+</span><span class="n">k</span>
        <span class="n">ans</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">if</span> <span class="n">dp</span><span class="p">[</span><span class="n">N</span><span class="p">][</span><span class="n">now</span><span class="p">]:</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">N</span><span class="p">)[::</span><span class="o">-</span><span class="mi">1</span><span class="p">]:</span>
                <span class="k">if</span> <span class="n">now</span><span class="o">-</span><span class="n">A</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">&gt;=</span><span class="mi">0</span> <span class="ow">and</span> <span class="n">dp</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">now</span><span class="o">-</span><span class="n">A</span><span class="p">[</span><span class="n">i</span><span class="p">]]:</span>
                    <span class="n">now</span> <span class="o">-=</span> <span class="n">A</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
                    <span class="n">ans</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">A</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">W</span><span class="o">+</span><span class="n">k</span><span class="p">,</span> <span class="n">ans</span><span class="p">)</span>
    <span class="k">return</span></div>


<div class="viewcode-block" id="PhysicalConstant"><a class="viewcode-back" href="../../../cpystal.core.html#cpystal.core.core.PhysicalConstant">[docs]</a><span class="k">class</span> <span class="nc">PhysicalConstant</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Physical constants.</span>

<span class="sd">    Attributes:</span>
<span class="sd">        pi: 3.14159265358979</span>
<span class="sd">        exp: 2.718281828459045</span>
<span class="sd">        NA: 6.02214076e+23 mol^-1</span>
<span class="sd">        kB: 1.380649e-23 J/K</span>
<span class="sd">        c: 299792458 m/s</span>
<span class="sd">        h: 6.62607015e-34 Js</span>
<span class="sd">        hbar: 1.0545718176461565e-34 Js</span>
<span class="sd">        e: 1.602176634e-19 C</span>
<span class="sd">        Patm: 101325 Pa</span>
<span class="sd">        Celsius: 273.15 K</span>
<span class="sd">        gn: 9.80665 ms^-2</span>
<span class="sd">        mu0: 1.2566370614359173e-06 NA^-2</span>
<span class="sd">        epsilon0: 8.854187817620389e-12 CV^-1m^-1</span>
<span class="sd">        me: 9.1093837015e-31 kg</span>
<span class="sd">        muB: 9.2740100783e-24 J/T</span>
<span class="sd">        muB_emu: 9.2740100783e-21 emu</span>
<span class="sd">        sigma: 5.670374419184428e-08 Wm-2K-4</span>
<span class="sd">        G: 6.6743e-11 Nm^2kg^-2</span>
<span class="sd">        alpha: 0.007297352565305217 </span>
<span class="sd">        phi0: 2.067833848461929e-15 Wb</span>
<span class="sd">        Rydberg: 10973731.556123963 m^-1</span>
<span class="sd">        a0: 5.291772111941794e-11 m</span>
<span class="sd">        R: 8.31446261815324 JK^-1mol^-1</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="c1"># 数学定数</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_pi</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_exp</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">e</span><span class="p">)</span>

        <span class="c1"># 定義値</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_NA</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">6.02214076</span> <span class="o">*</span> <span class="mi">10</span><span class="o">**</span><span class="p">(</span><span class="mi">23</span><span class="p">)</span> <span class="c1"># Avogadro定数 [mol^-1]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_kB</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">1.380649</span> <span class="o">*</span> <span class="mi">10</span><span class="o">**</span><span class="p">(</span><span class="o">-</span><span class="mi">23</span><span class="p">)</span> <span class="c1"># Boltzmann定数 [J/K]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_c</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mi">299792458</span> <span class="c1"># 光速 [m/s]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_h</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">6.62607015</span> <span class="o">*</span> <span class="mi">10</span><span class="o">**</span><span class="p">(</span><span class="o">-</span><span class="mi">34</span><span class="p">)</span> <span class="c1"># Planck定数 [Js]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_hbar</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_h</span> <span class="o">/</span> <span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">_pi</span><span class="p">)</span> <span class="c1"># Dirac定数 [Js]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_e</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">1.602176634</span> <span class="o">*</span> <span class="mi">10</span><span class="o">**</span><span class="p">(</span><span class="o">-</span><span class="mi">19</span><span class="p">)</span> <span class="c1"># 電気素量 [C]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_Kcd</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mi">683</span> <span class="c1"># 発光効率 [lm/W]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_Patm</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mi">101325</span> <span class="c1"># 標準大気圧 [Pa]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_Celsius</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">273.15</span> <span class="c1"># Celsius温度ゼロ点 [K]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_gn</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">9.80665</span> <span class="c1"># 標準重力加速度 [ms^-2]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_mu0</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mi">4</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">_pi</span> <span class="o">*</span> <span class="mi">10</span><span class="o">**</span><span class="p">(</span><span class="o">-</span><span class="mi">7</span><span class="p">)</span> <span class="c1"># 真空の透磁率(旧定義) [NA^-2]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_epsilon0</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">/</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_mu0</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">_c</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span> <span class="c1"># 真空の誘電率 [F/m]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_me</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">9.1093837015</span> <span class="o">*</span> <span class="mi">10</span><span class="o">**</span><span class="p">(</span><span class="o">-</span><span class="mi">31</span><span class="p">)</span> <span class="c1"># 電子質量 [kg]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_muB</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_e</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">_hbar</span> <span class="o">/</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">_me</span><span class="p">)</span> <span class="c1"># Bohr磁子 [J/T]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_muB_emu</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">9.2740100783</span> <span class="o">*</span> <span class="mi">10</span><span class="o">**</span><span class="p">(</span><span class="o">-</span><span class="mi">21</span><span class="p">)</span> <span class="c1"># Bohr磁子 [emu]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_sigma</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_pi</span><span class="o">**</span><span class="mi">2</span> <span class="o">/</span> <span class="mi">60</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">_kB</span><span class="o">**</span><span class="mi">4</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">_hbar</span><span class="o">**</span><span class="mi">3</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">_c</span><span class="o">**</span><span class="mi">2</span> <span class="c1"># Stefan-Boltzmann定数 [Wm^-2K^-4]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_G</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">6.67430</span> <span class="o">*</span> <span class="mi">10</span><span class="o">**</span><span class="p">(</span><span class="o">-</span><span class="mi">11</span><span class="p">)</span> <span class="c1"># 万有引力定数 [Nm^2kg^-2]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_alpha</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_e</span><span class="o">**</span><span class="mi">2</span> <span class="o">/</span> <span class="p">(</span><span class="mi">4</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">_pi</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">_epsilon0</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">_hbar</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">_c</span><span class="p">)</span> <span class="c1"># 微細構造定数 [dimensionless]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_phi0</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_h</span> <span class="o">/</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">_e</span><span class="p">)</span> <span class="c1"># 磁束量子 [Wb]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_Rydberg</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_alpha</span><span class="o">**</span><span class="mi">2</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">_me</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">_c</span> <span class="o">/</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">_h</span><span class="p">)</span> <span class="c1"># Rydberg定数 [m^-1]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_a0</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_alpha</span> <span class="o">/</span> <span class="p">(</span><span class="mi">4</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">_pi</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">_Rydberg</span><span class="p">)</span> <span class="c1"># Bohr半径 [m]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_R</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_NA</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">_kB</span> <span class="c1"># 気体定数 [JK^-1mol^-1]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_Lorenz</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_pi</span><span class="o">**</span><span class="mi">2</span> <span class="o">/</span> <span class="mi">3</span> <span class="o">*</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_kB</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">_e</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span> <span class="c1"># Lorenz定数 [WΩ/K^2]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_unit</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;NA&quot;</span><span class="p">:</span> <span class="s2">&quot;mol^-1&quot;</span><span class="p">,</span>
            <span class="s2">&quot;kB&quot;</span><span class="p">:</span> <span class="s2">&quot;J/K&quot;</span><span class="p">,</span>
            <span class="s2">&quot;c&quot;</span><span class="p">:</span> <span class="s2">&quot;m/s&quot;</span><span class="p">,</span>
            <span class="s2">&quot;h&quot;</span><span class="p">:</span> <span class="s2">&quot;Js&quot;</span><span class="p">,</span>
            <span class="s2">&quot;hbar&quot;</span><span class="p">:</span> <span class="s2">&quot;Js&quot;</span><span class="p">,</span>
            <span class="s2">&quot;e&quot;</span><span class="p">:</span> <span class="s2">&quot;C&quot;</span><span class="p">,</span>
            <span class="s2">&quot;Patm&quot;</span><span class="p">:</span> <span class="s2">&quot;Pa&quot;</span><span class="p">,</span>
            <span class="s2">&quot;Celsius&quot;</span><span class="p">:</span> <span class="s2">&quot;K&quot;</span><span class="p">,</span>
            <span class="s2">&quot;gn&quot;</span><span class="p">:</span> <span class="s2">&quot;ms^-2&quot;</span><span class="p">,</span>

            <span class="s2">&quot;mu0&quot;</span><span class="p">:</span> <span class="s2">&quot;NA^-2&quot;</span><span class="p">,</span>
            <span class="s2">&quot;epsilon0&quot;</span><span class="p">:</span> <span class="s2">&quot;CV^-1m^-1&quot;</span><span class="p">,</span>
            <span class="s2">&quot;me&quot;</span><span class="p">:</span> <span class="s2">&quot;kg&quot;</span><span class="p">,</span>
            <span class="s2">&quot;muB&quot;</span><span class="p">:</span> <span class="s2">&quot;J/T&quot;</span><span class="p">,</span>
            <span class="s2">&quot;muB_emu&quot;</span><span class="p">:</span> <span class="s2">&quot;emu&quot;</span><span class="p">,</span>
            <span class="s2">&quot;sigma&quot;</span><span class="p">:</span> <span class="s2">&quot;Wm^-2K^-4&quot;</span><span class="p">,</span>
            <span class="s2">&quot;G&quot;</span><span class="p">:</span> <span class="s2">&quot;Nm^2kg^-2&quot;</span><span class="p">,</span>
            <span class="s2">&quot;alpha&quot;</span><span class="p">:</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
            <span class="s2">&quot;phi0&quot;</span><span class="p">:</span> <span class="s2">&quot;Wb&quot;</span><span class="p">,</span>
            <span class="s2">&quot;Rydberg&quot;</span><span class="p">:</span> <span class="s2">&quot;m^-1&quot;</span><span class="p">,</span>
            <span class="s2">&quot;a0&quot;</span><span class="p">:</span> <span class="s2">&quot;m&quot;</span><span class="p">,</span>
            <span class="s2">&quot;R&quot;</span><span class="p">:</span> <span class="s2">&quot;JK^-1mol^-1&quot;</span><span class="p">,</span>
            <span class="s2">&quot;Lorenz&quot;</span><span class="p">:</span> <span class="s2">&quot;WOhm/K^2&quot;</span><span class="p">,</span>
            
        <span class="p">}</span>
    
    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">pi</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span> <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_pi</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">exp</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span> <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_exp</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">NA</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span> <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_NA</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">kB</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span> <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_kB</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">c</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span> <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_c</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">h</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span> <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_h</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">hbar</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span> <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_hbar</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">e</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span> <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_e</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">Kcd</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span> <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_Kcd</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">Patm</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span> <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_Patm</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">Celsius</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span> <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_Celsius</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">gn</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span> <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_gn</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">mu0</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span> <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_mu0</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">epsilon0</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span> <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_epsilon0</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">me</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span> <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_me</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">muB</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span> <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_muB</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">muB_emu</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span> <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_muB_emu</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">sigma</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span> <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_sigma</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">G</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span> <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_G</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">alpha</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span> <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_alpha</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">phi0</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span> <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_phi0</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">Rydberg</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span> <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_Rydberg</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">a0</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span> <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_a0</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">R</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span> <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_R</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">unit</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]:</span> <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_unit</span>

    <span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="n">res</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__dict__</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">k</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_unit</span><span class="p">:</span>
                <span class="n">res</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">k</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">v</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_unit</span><span class="p">[</span><span class="n">k</span><span class="p">[</span><span class="mi">1</span><span class="p">:]]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">res</span><span class="p">)</span></div>
        

<div class="viewcode-block" id="main"><a class="viewcode-back" href="../../../cpystal.core.html#cpystal.core.core.main">[docs]</a><span class="k">def</span> <span class="nf">main</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
    <span class="k">pass</span>
    <span class="k">return</span></div>

<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="n">main</span><span class="p">()</span>

</pre></div>

          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="../../../index.html">cpystal</a></h1>








<h3>Navigation</h3>
<p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../cpystal.html">cpystal package</a></li>
</ul>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../../../index.html">Documentation overview</a><ul>
  <li><a href="../../index.html">Module code</a><ul>
  </ul></li>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>document.getElementById('searchbox').style.display = "block"</script>








        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2023, Helve.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 5.0.2</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.12</a>
      
    </div>

    

    
  </body>
</html>